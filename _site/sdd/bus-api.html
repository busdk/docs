<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>bus-api — Software Design Document | BusDK Design Document</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="bus-api — Software Design Document" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Bus API provides a local REST JSON API gateway for BusDK workspaces." />
<meta property="og:description" content="Bus API provides a local REST JSON API gateway for BusDK workspaces." />
<link rel="canonical" href="http://localhost:4000/sdd/bus-api.html" />
<meta property="og:url" content="http://localhost:4000/sdd/bus-api.html" />
<meta property="og:site_name" content="BusDK Design Document" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="bus-api — Software Design Document" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Bus API provides a local REST JSON API gateway for BusDK workspaces.","headline":"bus-api — Software Design Document","url":"http://localhost:4000/sdd/bus-api.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=d739a5c055683d9701ead80f9ac87dbed78e5d75">
    <meta name="color-scheme" content="light dark">

<!-- Theme color for browser UI (light/dark). Keep in sync with busdk tokens. -->
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#0b0f14" media="(prefers-color-scheme: dark)">

  </head>
  <body class="busdk-docs-page">
    <div class="busdk-docs">
      <header class="busdk-site-header">
        <div class="busdk-site-header-inner">
          <a class="busdk-site-header-logo" href="/">BusDK Design Document</a>
        </div>
      </header>

      <div class="busdk-docs-body">
        
        <nav class="busdk-sidebar" aria-label="Documentation">
  <div class="busdk-sidebar-inner">
    <a class="busdk-sidebar-home" href="/">BusDK Design Document</a>
    <ul class="busdk-sidebar-nav">
      
      <li class="busdk-sidebar-section">
        <span class="busdk-sidebar-section-title">Get started</span>
        <ul class="busdk-sidebar-links">
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/overview/">Overview</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/design-goals/">Design goals and requirements</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/implementation/development-status">Development status</a>
          </li>
          
        </ul>
      </li>
      
      <li class="busdk-sidebar-section">
        <span class="busdk-sidebar-section-title">Design</span>
        <ul class="busdk-sidebar-links">
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link busdk-sidebar-link--current" href="/sdd/">Software Design Documents (SDD)</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/architecture/">System architecture</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/data/">Data formats and storage</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/layout/">Data directory layout</a>
          </li>
          
        </ul>
      </li>
      
      <li class="busdk-sidebar-section">
        <span class="busdk-sidebar-section-title">Workflows</span>
        <ul class="busdk-sidebar-links">
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/workflow/accounting-workflow-overview">Accounting workflow overview</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/workflow/">Example end-to-end workflow</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/cli/">CLI tooling and workflow</a>
          </li>
          
        </ul>
      </li>
      
      <li class="busdk-sidebar-section">
        <span class="busdk-sidebar-section-title">Reference</span>
        <ul class="busdk-sidebar-links">
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/master-data/">Master data (business objects)</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/modules/">Modules</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/integration/">Integration and future interfaces</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/extensibility/">Extensibility model</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/testing/">Testing</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/references/">References and foundations</a>
          </li>
          
        </ul>
      </li>
      
      <li class="busdk-sidebar-section">
        <span class="busdk-sidebar-section-title">Compliance</span>
        <ul class="busdk-sidebar-links">
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/compliance/fi-bookkeeping-and-tax-audit">Finnish bookkeeping and tax-audit</a>
          </li>
          
        </ul>
      </li>
      
    </ul>
  </div>
</nav>

        

        <main class="busdk-main busdk-main--with-sidebar">
          <div class="busdk-main-inner markdown-body">
            
            <header class="busdk-page-header">
              <div class="busdk-content-inner">
                <h1><a href="http://localhost:4000/">BusDK Design Document</a></h1>
              </div>
            </header>
            

            <section class="busdk-chapter busdk-chapter--level-2"><div class="busdk-chapter-inner">
<section class="busdk-chapter busdk-chapter--level-3 busdk-chapter--title"><div class="busdk-chapter-section-inner busdk-content-inner">
<h2 id="bus-api">bus-api</h2>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="introduction-and-overview">Introduction and Overview</h3>

<p>Bus API provides a local REST JSON API gateway for BusDK workspaces. When started, it serves a CRUD API over the BusDK data files in the selected workspace root by delegating all dataset semantics to the <a href="./bus-data">bus-data</a> Go library (Table Schema, Data Package, CSV operations, mutation policies, and validation). Every dependency on another Bus module — bus-data, bus-bfl, or any domain module such as bus-accounts — is satisfied only by calling that module’s Go library; the server never executes any Bus module CLI. The API supports the same operations as bus-data — including row CRUD, schema mutation (field add/remove/rename, schema patch, primary and foreign key changes), package and resource management — so that system administrators and tools can manage tables and schemas directly over HTTP, and create or maintain custom data outside of Bus domain modules. Operations can be gated by feature flags or modes (e.g. <code class="language-plaintext highlighter-rouge">--read-only</code>) so that a restricted API can be started when needed; by default all operations are enabled. Bus API also exposes bus-modules so that domain modules such as bus-accounts can provide correct access to their data through their Go library: the API delegates to bus-data for generic workspace resources and to module libraries for module-owned data and semantics.</p>

<p>Intended users are system administrators, developers, and tools that integrate with BusDK via HTTP. The document’s purpose is to define the API contract, security model, and integration points so that implementors and reviewers have a single source of truth. The server serves HTTP by default. Optional HTTPS is supported via SSL command-line parameters when the operator supplies certificate and key. In many deployments TLS is handled by an external service (e.g. reverse proxy or load balancer) in front of the API. Out of scope for this module: user accounts, session management, OAuth, and distributed deployment.</p>

<p>By default, <code class="language-plaintext highlighter-rouge">bus-api</code> binds only to localhost and prints a capability-style URL that includes an unguessable random path prefix. Clients must know that URL to access the API. This keeps the MVP simple while still preventing accidental access by unrelated local processes.</p>

<p>Bus API can expose formula-projected views when <a href="./bus-data">bus-data</a> is configured to evaluate formula fields; formula semantics come from <a href="./bus-data">bus-data</a>’s integration with <a href="./bus-bfl">bus-bfl</a> (including range resolution through <a href="./bus-data">bus-data</a>’s deterministic range resolver). Bus API also outputs an OpenAPI document so clients can discover and generate client bindings for the HTTP surface. To support change detection, the API exposes an event stream: clients can subscribe to a long-lived stream and receive events whenever mutations are performed through the API (row create/update/delete, schema changes, or resource and package changes). Events are emitted only for mutations that occur via this API instance, so that tools and UIs can react to CSV and schema changes without polling.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="requirements">Requirements</h3>

<section class="busdk-chapter busdk-chapter--level-4"><h4 id="functional-requirements">Functional Requirements</h4>

<p>FR-API-001 Local API server. The module MUST provide a command that starts an HTTP server which serves a REST JSON API over the workspace in the selected root directory. Acceptance criteria: starting the server succeeds without configuration in a workspace that has readable datasets and returns non-zero with a deterministic diagnostic if the workspace root is not readable.</p>

<p>FR-API-002 Capability URL with randomness. On startup, the server MUST generate an unguessable random token and MUST require all API requests to be scoped under a path prefix containing that token. Acceptance criteria: the server prints a full base URL that includes the token and a port, requests outside the token prefix return 404 (or equivalent), and the token is at least 128 bits of entropy by default.</p>

<p>FR-API-003 Safe default binding. The server MUST bind to <code class="language-plaintext highlighter-rouge">127.0.0.1</code> by default and MUST NOT listen on non-loopback interfaces unless explicitly requested. Acceptance criteria: without flags, the server is reachable only from localhost, and a non-loopback bind requires an explicit <code class="language-plaintext highlighter-rouge">--listen</code> flag.</p>

<p>FR-API-004 Workspace root and path safety. The server MUST treat the workspace root as the filesystem security boundary and MUST prevent path traversal outside that root. Acceptance criteria: all filesystem paths accepted by the API are workspace-relative, attempts to escape the root are rejected deterministically, and the server never reads or writes outside the selected root.</p>

<p>FR-API-005 bus-data as the authoritative engine. All dataset, schema, and package operations MUST be implemented by calling the <a href="./bus-data">bus-data</a> Go library only; the module MUST NOT shell out to, exec, or otherwise invoke the bus-data CLI or any other Bus module CLI. Acceptance criteria: all CRUD and validation outcomes match <a href="./bus-data">bus-data</a> library behavior for the same inputs, including formula projection and range resolution; no code path executes an external bus-data or bus-* process.</p>

<p>FR-API-006 Resource discovery. The API MUST expose endpoints to list resources available in the workspace and to retrieve the workspace <code class="language-plaintext highlighter-rouge">datapackage.json</code> when present. Acceptance criteria: resource listing is deterministic, ordered, and reflects <code class="language-plaintext highlighter-rouge">datapackage.json</code> when it exists; if no data package exists, listing still works by discovering tables with beside-the-table schemas using <a href="./bus-data">bus-data</a> conventions.</p>

<p>FR-API-007 CRUD operations. The API MUST support create, read, update, and delete operations over table rows, subject to <a href="./bus-data">bus-data</a> schema constraints and <code class="language-plaintext highlighter-rouge">busdk.update_policy</code> / <code class="language-plaintext highlighter-rouge">busdk.delete_policy</code>. Acceptance criteria: add/update/delete are rejected when policies forbid them and accepted only when allowed; all mutations are validated and are atomic (no partial writes).</p>

<p>FR-API-008 Formula-projected reads. The API MUST support read operations that return projected values for formula-enabled fields without writing back to CSV, and MUST provide an opt-in mode to include formula source alongside computed values. Acceptance criteria: default reads return computed values, opt-in mode returns computed values plus a non-colliding representation of the source, and stored CSV is unchanged.</p>

<p>FR-API-009 Validation endpoints. The API MUST expose endpoints that validate (a) a single resource and (b) the full workspace package, returning deterministic diagnostics. Acceptance criteria: validation returns stable machine-readable error objects and stable ordering of multiple errors.</p>

<p>FR-API-010 OpenAPI output. The module MUST provide (a) a CLI command to print the OpenAPI document and (b) an HTTP endpoint to fetch it from a running server. Acceptance criteria: the OpenAPI document is valid OpenAPI 3.1, describes the versioned API paths, and models the token path prefix using OpenAPI server variables or an equivalent mechanism.</p>

<p>FR-API-011 Embedded runtime assets. The binary MUST embed everything needed to serve the API and the OpenAPI document. Acceptance criteria: <code class="language-plaintext highlighter-rouge">bus-api</code> starts and serves OpenAPI without requiring external template files, a generated directory, or runtime downloads.</p>

<p>FR-API-012 Schema and resource mutation. The API MUST expose schema and resource mutation operations that delegate to the <a href="./bus-data">bus-data</a> Go library only (no CLI invocation), so that the same capabilities provided by the bus-data library (schema field add/remove/rename, schema patch, primary and foreign key changes, resource add/remove/rename, package patch) are available over HTTP. Acceptance criteria: mutating endpoints call the bus-data library for correctness; behavior matches bus-data for the same inputs; destructive or integrity-sensitive operations respect the same force and dry-run semantics as bus-data where applicable. Fine-grained schema field and key operations are exposed as dedicated REST endpoints as specified in the HTTP API Surface section.</p>

<p>FR-API-013 Module exposure. The API MUST expose bus-modules so that domain modules (e.g. bus-accounts) can provide access to their data and semantics through their Go library only; the server MUST NOT invoke any Bus module CLI. Acceptance criteria: the server delegates requests to registered module backends by calling their Go APIs in-process; module code provides handlers or resource views for module-owned data; the API surface for module-provided endpoints is documented and stable.</p>

<p>FR-API-014 Event stream for change detection. The API MUST expose an endpoint that allows clients to subscribe to a stream of events describing changes to workspace data performed through the API. Events MUST be emitted for (a) row create, update, and delete (CSV changes) and (b) schema changes (field add/remove/rename, primary or foreign key changes, schema patch) and (c) resource and package changes (resource add/remove/rename, package patch). Acceptance criteria: clients can open a long-lived connection to the event stream and receive exactly one event per successful mutating request, in request order; each event is machine-readable with a stable type and payload shape; events are emitted only for mutations performed via this API instance (no filesystem watchers); the OpenAPI document describes the event endpoint and event payloads.</p>

</section><section class="busdk-chapter busdk-chapter--level-4"><h4 id="non-functional-requirements">Non-Functional Requirements</h4>

<p>NFR-API-001 Deterministic responses. For the same workspace state and the same sequence of requests, responses MUST be deterministic in content and ordering. Acceptance criteria: JSON object key ordering is stable, arrays are ordered deterministically, and error payloads are stable and comparable in tests.</p>

<p>NFR-API-002 No hidden background work. The server MUST NOT mutate workspace data without an explicit API request and MUST NOT run filesystem watchers by default. Acceptance criteria: no writes occur after startup until a mutating endpoint is called; the event stream is driven solely by mutating API requests in this process and does not require background filesystem watchers.</p>

<p>NFR-API-003 Concurrency safety. The server MUST prevent concurrent write corruption. Acceptance criteria: all mutating operations obtain a workspace-level lock (or equivalent deterministic lock strategy) and either serialize writers or reject concurrent writes with a deterministic “busy” error.</p>

<p>NFR-API-004 Minimal authentication surface. The MVP MUST rely on loopback binding + capability URL token and MUST NOT implement accounts, sessions, OAuth, cookies, or stored credentials. Acceptance criteria: no secrets are written to disk by default, and the token is not logged except as part of the startup URL that the user explicitly receives.</p>

<p>NFR-API-005 Operation gating via feature flags. The server MUST support gating operations (e.g. read-only mode) via configuration or flags so that a restricted API can be started. By default all operations MUST be enabled. Acceptance criteria: when a restriction is enabled (e.g. <code class="language-plaintext highlighter-rouge">--read-only</code>), mutating endpoints return a deterministic error (e.g. 403); with default configuration, all supported operations are available.</p>

<p>NFR-API-006 Maintainability. The module MUST be library-first with a thin CLI wrapper, and MUST reuse BusDK standard global flags where applicable.</p>

<p>NFR-API-007 Library-only integration with Bus modules. Every dependency on another Bus module (bus-data, bus-bfl, bus-accounts, or any other bus-* module) MUST be satisfied by calling that module’s Go library only. The bus-api process MUST NOT execute, shell out to, or invoke the CLI binary of bus-data, bus-bfl, or any other Bus module. Acceptance criteria: no code path runs <code class="language-plaintext highlighter-rouge">exec</code>, <code class="language-plaintext highlighter-rouge">os/exec</code>, or equivalent to start a bus-* process; all integration is in-process library calls; tests and code review can verify the constraint.</p>

<p>NFR-API-008 Performance. The server MUST remain responsive for local use on typical workspace datasets. Acceptance criteria: health and read endpoints respond within a documented timeout under normative load; no unbounded in-memory growth for listing resources or reading rows within the scope of a single request; event delivery to subscribers does not block the mutating request.</p>

<p>NFR-API-009 Scalability. The module targets a single workspace per server instance. Acceptance criteria: the design does not assume distributed deployment or multi-tenant sharing; scaling is by running additional instances bound to different workspace roots.</p>

<p>NFR-API-010 Reliability. The server MUST fail requests deterministically without corrupting workspace data. Acceptance criteria: any request that fails leaves the workspace unchanged; error responses are stable and include sufficient context for diagnosis.</p>

</section>
</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="system-architecture">System Architecture</h3>

<p>Bus API is an HTTP gateway that delegates to <a href="./bus-data">bus-data</a> for workspace data and to bus-module libraries for module-owned data, satisfying FR-API-001, FR-API-005, FR-API-006, FR-API-007, FR-API-012, FR-API-013, and FR-API-014. The <strong>HTTP layer</strong> parses requests, validates path parameters, enforces workspace-root confinement (FR-API-004), applies operation gating (NFR-API-005), and routes to the appropriate backend. The <strong>workspace engine</strong> is <a href="./bus-data">bus-data</a>: it handles CSV, Table Schema and Data Package descriptors, schema and resource mutation, mutation policies, foreign keys, and formula projection. Formula evaluation is exposed through <a href="./bus-data">bus-data</a>’s integration with <a href="./bus-bfl">bus-bfl</a> (FR-API-008). <strong>Module backends</strong> are Go libraries (e.g. bus-accounts) that register with the server and provide handlers or resource views for their data; the server delegates module-scoped requests to them by in-process library calls only (no CLI execution; NFR-API-007). The <strong>event stream</strong> is an in-process fan-out: when a mutating request succeeds, the server emits one or more mutation events to all connected event subscribers. Events are not persisted; delivery is best-effort to current subscribers only. The <strong>OpenAPI generator</strong> is embedded and emits an OpenAPI 3.1 document describing the stable API surface including the event endpoint (FR-API-010, FR-API-014).</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="key-decisions">Key Decisions</h3>

<p>KD-API-001 bus-data is the authority for workspace data (FR-API-005). Bus API never re-implements schema parsing, validation, mutation, or formula rules for generic workspace resources; it delegates to <a href="./bus-data">bus-data</a> for correctness and consistency. Module-owned data is served by module backends (FR-API-013), which use their own Go libraries and may call bus-data where appropriate.</p>

<p>KD-API-008 Library-only integration (NFR-API-007). All integration with Bus modules is via their Go libraries. bus-api never executes the CLI of bus-data, bus-bfl, or any other bus-* module; doing so would violate the library-only contract and would make correctness, testing, and process boundaries harder to guarantee.</p>

<p>KD-API-002 Capability URL instead of auth (NFR-API-004). The initial security model is “localhost + unguessable path prefix”, not accounts or tokens stored on disk.</p>

<p>KD-API-003 Stable, versioned HTTP surface. The HTTP API is versioned under <code class="language-plaintext highlighter-rouge">/v1/</code> to allow future evolution without breaking clients.</p>

<p>KD-API-004 OpenAPI-first discoverability (FR-API-010). The module always ships an OpenAPI document so clients can be generated and validated.</p>

<p>KD-API-005 HTTP by default, optional HTTPS via SSL parameters. The server listens for HTTP by default. When the operator provides SSL command-line parameters (certificate and key), the server MAY listen for HTTPS instead. TLS is often terminated by an external service (reverse proxy, load balancer); the module supports optional in-process HTTPS for deployments that need it.</p>

<p>KD-API-006 Full bus-data parity with optional gating. The API exposes the same operations as bus-data (row CRUD, schema and resource mutation, package and validation), so that system administrators and tools can manage workspace data over HTTP and create custom data outside of Bus domain modules. Operations can be restricted by feature flags or modes (e.g. <code class="language-plaintext highlighter-rouge">--read-only</code>); by default everything is enabled.</p>

<p>KD-API-007 Module exposure via Go library. Bus-modules are exposed through bus-api so that domain modules (e.g. bus-accounts) can provide correct access to their data in code using their Go library only (NFR-API-007). The server delegates to module backends for module-owned resources by in-process library calls. Module endpoints use the path-based layout <code class="language-plaintext highlighter-rouge">/{token}/v1/modules/{module}/...</code>, and which modules are enabled is controlled by configuration or CLI flags (e.g. <code class="language-plaintext highlighter-rouge">--enable-module</code>). Module backends implement <code class="language-plaintext highlighter-rouge">http.Handler</code>; the server strips the path prefix and forwards the request (see IF-API-003).</p>

<p>KD-API-009 Events only for API-originated mutations (FR-API-014). The event stream is driven solely by mutating requests handled by this API instance. The server does not run filesystem watchers by default and does not emit events for changes made to the workspace by other processes or by direct file edits; clients that need to detect external changes must poll or use a separate mechanism.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="component-design-and-interfaces">Component Design and Interfaces</h3>

<section class="busdk-chapter busdk-chapter--level-4"><h4 id="if-api-001-go-library-interface-server-core">IF-API-001 Go library interface (server core)</h4>

<p>The module exposes a Go package that can be used by other Go programs to embed the Bus API server.</p>

<p>Normative shape (names illustrative, not mandatory):</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">type Server struct { … }</code></li>
  <li><code class="language-plaintext highlighter-rouge">func NewServer(root string, opt Options) (*Server, error)</code></li>
  <li><code class="language-plaintext highlighter-rouge">func (s *Server) Serve(l net.Listener) error</code></li>
  <li><code class="language-plaintext highlighter-rouge">func (s *Server) Handler() http.Handler</code></li>
</ul>

<p><code class="language-plaintext highlighter-rouge">Options</code> includes:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">ListenAddr</code>, <code class="language-plaintext highlighter-rouge">Port</code> (0 allowed for “pick free port”)</li>
  <li>
<code class="language-plaintext highlighter-rouge">Token</code> (optional; if empty, generated randomly)</li>
  <li>
<code class="language-plaintext highlighter-rouge">APIVersion</code> (default <code class="language-plaintext highlighter-rouge">v1</code>)</li>
  <li>
<code class="language-plaintext highlighter-rouge">CORS</code> (disabled by default)</li>
  <li>
<code class="language-plaintext highlighter-rouge">Locks</code> strategy (default: workspace write lock)</li>
  <li>
<code class="language-plaintext highlighter-rouge">TLSCertFile</code>, <code class="language-plaintext highlighter-rouge">TLSKeyFile</code> (optional; when both set, serve HTTPS instead of HTTP)</li>
  <li>
<code class="language-plaintext highlighter-rouge">ReadOnly</code> or operation flags (optional; when set, mutating endpoints return 403; default: all operations enabled)</li>
  <li>
<code class="language-plaintext highlighter-rouge">ModuleBackends</code> or equivalent (optional; list of registered module backends that provide handlers or resource views for module-owned data)</li>
  <li>
<code class="language-plaintext highlighter-rouge">ModulesEnabled</code> or equivalent (optional; list of module identifiers to enable; only backends in this list are mounted under <code class="language-plaintext highlighter-rouge">/{token}/v1/modules/{module}/...</code>. When empty or unset, no module endpoints are exposed.)</li>
  <li>
<code class="language-plaintext highlighter-rouge">EventBufferSize</code> or equivalent (optional; maximum number of events to buffer per subscriber when delivery is slower than production; when full, behavior is implementation-defined — drop oldest, drop newest, or back-pressure. Default is documented and finite.)</li>
</ul>

</section><section class="busdk-chapter busdk-chapter--level-4"><h4 id="if-api-004-event-stream">IF-API-004 Event stream</h4>

<p>The API exposes a long-lived event stream so that clients can detect changes to workspace data (CSV rows and schemas) performed through the API (FR-API-014). Transport: Server-Sent Events (SSE). Endpoint: <code class="language-plaintext highlighter-rouge">GET /{token}/v1/events</code>. Response: <code class="language-plaintext highlighter-rouge">Content-Type: text/event-stream</code>. Each event is a single SSE message; the <code class="language-plaintext highlighter-rouge">data</code> payload is a single line of UTF-8 JSON conforming to the mutation event payload shape below. Events are emitted in the order mutating requests complete; exactly one event (or one event per logical change when a single request causes multiple changes) is emitted per successful mutation. Optional query parameters: <code class="language-plaintext highlighter-rouge">resource</code> (filter by resource name), <code class="language-plaintext highlighter-rouge">type</code> (filter by event type prefix). Unsupported query values are ignored; filtering is best-effort and may be implemented server-side or documented as client-filtered. Connection lifecycle: the server keeps the connection open until the client disconnects or the server shuts down; no persistence or replay of events. Subscribers receive only events that occur after they connect.</p>

<p>Mutation event payload shape (stable JSON object; key order is deterministic for tests):</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">type</code> (string, required): Event type. Values include <code class="language-plaintext highlighter-rouge">resource.rows.created</code>, <code class="language-plaintext highlighter-rouge">resource.rows.updated</code>, <code class="language-plaintext highlighter-rouge">resource.rows.deleted</code>, <code class="language-plaintext highlighter-rouge">resource.schema.changed</code>, <code class="language-plaintext highlighter-rouge">resource.added</code>, <code class="language-plaintext highlighter-rouge">resource.removed</code>, <code class="language-plaintext highlighter-rouge">resource.renamed</code>, <code class="language-plaintext highlighter-rouge">package.changed</code>. New types may be added in future versions; clients MUST ignore unknown types.</li>
  <li>
<code class="language-plaintext highlighter-rouge">resource</code> (string, optional): Resource name (table name) when the event is resource-scoped.</li>
  <li>
<code class="language-plaintext highlighter-rouge">rowKey</code> (array of values, optional): Primary key of the affected row in schema primaryKey order, for row events; omitted for schema or package events.</li>
  <li>
<code class="language-plaintext highlighter-rouge">summary</code> (string, optional): Short human-readable summary of the change; for diagnostics only, not for machine logic.</li>
  <li>Additional properties MAY be present for extensibility; clients MUST not rely on them for correctness.</li>
</ul>

<p>The Go server core MUST provide a way to publish mutation events (e.g. a callback or channel) that is invoked after each successful mutating operation so that the HTTP layer can fan out to all active SSE connections.</p>

</section><section class="busdk-chapter busdk-chapter--level-4"><h4 id="if-api-002-module-cli">IF-API-002 Module CLI</h4>

<p>The module exposes <code class="language-plaintext highlighter-rouge">bus-api</code> as a CLI entry point (and is also expected to be runnable via the dispatcher as <code class="language-plaintext highlighter-rouge">bus api …</code>).</p>

<p>Global flags follow BusDK conventions (not repeated here verbatim), including <code class="language-plaintext highlighter-rouge">--help</code>, <code class="language-plaintext highlighter-rouge">--version</code>, and <code class="language-plaintext highlighter-rouge">-C/--chdir</code> for selecting workspace root.</p>

<p>Commands:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bus-api serve</code> (default if no command is provided)</p>

    <ul>
      <li>Starts the server, prints the capability base URL to stdout, writes diagnostics to stderr.</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bus-api openapi</code></p>

    <ul>
      <li>Prints the OpenAPI document (JSON) to stdout.</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">bus-api version</code></p>

    <ul>
      <li>Prints version info.</li>
    </ul>
  </li>
</ul>

<p>Serve flags (module-specific):</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">--listen &lt;addr&gt;</code> default <code class="language-plaintext highlighter-rouge">127.0.0.1</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">--port &lt;n&gt;</code> default <code class="language-plaintext highlighter-rouge">0</code> (auto)</li>
  <li>
<code class="language-plaintext highlighter-rouge">--token &lt;string&gt;</code> optional (for tests / scripted reuse); if absent, generated</li>
  <li>
<code class="language-plaintext highlighter-rouge">--token-bytes &lt;n&gt;</code> default <code class="language-plaintext highlighter-rouge">32</code> (256 bits)</li>
  <li>
<code class="language-plaintext highlighter-rouge">--base-path &lt;path&gt;</code> default <code class="language-plaintext highlighter-rouge">/{token}/v1</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">--cors-origin &lt;origin&gt;</code> repeatable; default none</li>
  <li>
<code class="language-plaintext highlighter-rouge">--tls-cert &lt;file&gt;</code> optional; path to TLS certificate file; when provided together with <code class="language-plaintext highlighter-rouge">--tls-key</code>, serve HTTPS instead of HTTP</li>
  <li>
<code class="language-plaintext highlighter-rouge">--tls-key &lt;file&gt;</code> optional; path to TLS private key file; when provided together with <code class="language-plaintext highlighter-rouge">--tls-cert</code>, serve HTTPS instead of HTTP</li>
  <li>
<code class="language-plaintext highlighter-rouge">--read-only</code> forces all mutating endpoints to return 403 (NFR-API-005); by default all operations are enabled</li>
  <li>
<code class="language-plaintext highlighter-rouge">--enable-module &lt;name&gt;</code> repeatable; enables the module with the given identifier (e.g. <code class="language-plaintext highlighter-rouge">accounts</code> for bus-accounts). Only enabled modules are mounted; when no <code class="language-plaintext highlighter-rouge">--enable-module</code> is given, no module endpoints are exposed.</li>
</ul>

</section><section class="busdk-chapter busdk-chapter--level-4"><h4 id="if-api-003-module-backends">IF-API-003 Module backends</h4>

<p>Bus-modules expose their data through bus-api by implementing a backend contract (Go interface) and registering with the server. The API is path-based: module-provided endpoints live under <code class="language-plaintext highlighter-rouge">/{token}/v1/modules/{module}/...</code>, where <code class="language-plaintext highlighter-rouge">{module}</code> is a stable, lowercase module identifier (e.g. <code class="language-plaintext highlighter-rouge">accounts</code> for bus-accounts). Which modules are exposed is controlled by configuration or CLI: only modules explicitly enabled (e.g. via <code class="language-plaintext highlighter-rouge">ModulesEnabled</code> in <code class="language-plaintext highlighter-rouge">Options</code> or repeatable <code class="language-plaintext highlighter-rouge">--enable-module &lt;name&gt;</code>) are mounted; when none are enabled, no module paths are served. Modules implement <code class="language-plaintext highlighter-rouge">http.Handler</code> (or <code class="language-plaintext highlighter-rouge">http.HandlerFunc</code>). The server mounts each enabled backend at <code class="language-plaintext highlighter-rouge">/{token}/v1/modules/{module}/</code> and forwards requests; the handler receives the request with that prefix stripped so it sees only the module-relative path. The module uses its own Go library (and the bus-data library where appropriate) to serve the response. All integration is library-only; no Bus module CLI is ever executed (NFR-API-007). The OpenAPI document MUST describe the combined surface including module-provided paths for all enabled backends (FR-API-013).</p>

</section>
</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="http-api-surface-v1">HTTP API Surface (v1)</h3>

<p>All endpoints are rooted under the capability prefix:</p>

<p><code class="language-plaintext highlighter-rouge">/{token}/v1/...</code></p>

<p>Core endpoints:</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">GET /{token}/v1/healthz</code> → <code class="language-plaintext highlighter-rouge">{ "status": "ok" }</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">GET /{token}/v1/openapi.json</code> → OpenAPI document</li>
  <li>
<code class="language-plaintext highlighter-rouge">GET /{token}/v1/events</code> → Server-Sent Events stream of mutation events (FR-API-014). Query params (optional): <code class="language-plaintext highlighter-rouge">resource</code>, <code class="language-plaintext highlighter-rouge">type</code>. Each event is one SSE message; <code class="language-plaintext highlighter-rouge">data</code> is a single line of JSON with keys <code class="language-plaintext highlighter-rouge">type</code>, <code class="language-plaintext highlighter-rouge">resource</code> (optional), <code class="language-plaintext highlighter-rouge">rowKey</code> (optional), <code class="language-plaintext highlighter-rouge">summary</code> (optional). Event types: <code class="language-plaintext highlighter-rouge">resource.rows.created</code>, <code class="language-plaintext highlighter-rouge">resource.rows.updated</code>, <code class="language-plaintext highlighter-rouge">resource.rows.deleted</code>, <code class="language-plaintext highlighter-rouge">resource.schema.changed</code>, <code class="language-plaintext highlighter-rouge">resource.added</code>, <code class="language-plaintext highlighter-rouge">resource.removed</code>, <code class="language-plaintext highlighter-rouge">resource.renamed</code>, <code class="language-plaintext highlighter-rouge">package.changed</code>.</li>
  <li>
<code class="language-plaintext highlighter-rouge">GET /{token}/v1/resources</code> → list of resources (deterministically ordered)</li>
  <li>
<code class="language-plaintext highlighter-rouge">GET /{token}/v1/package</code> → <code class="language-plaintext highlighter-rouge">datapackage.json</code> as stored (404 if absent)</li>
  <li>
<code class="language-plaintext highlighter-rouge">PATCH /{token}/v1/package</code> → apply merge patch (delegates to <code class="language-plaintext highlighter-rouge">bus-data</code> semantics)</li>
  <li>
<code class="language-plaintext highlighter-rouge">GET /{token}/v1/resources/{name}/schema</code> → Table Schema JSON</li>
  <li>
<code class="language-plaintext highlighter-rouge">PATCH /{token}/v1/resources/{name}/schema</code> → apply schema merge patch (delegates to bus-data; subject to operation gating)</li>
  <li>Fine-grained schema field and key operations (delegate to bus-data library; request/response bodies mirror library parameters and support optional <code class="language-plaintext highlighter-rouge">force</code> and <code class="language-plaintext highlighter-rouge">dry_run</code> where applicable):
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">POST /{token}/v1/resources/{name}/schema/fields</code> — add field (body: field descriptor; optional default, description, rdfType, etc.)</li>
      <li>
<code class="language-plaintext highlighter-rouge">PATCH /{token}/v1/resources/{name}/schema/fields/{field}</code> — rename field or set type/format/constraints/missing-values (body specifies change; query or body may include <code class="language-plaintext highlighter-rouge">force</code> where the library allows)</li>
      <li>
<code class="language-plaintext highlighter-rouge">DELETE /{token}/v1/resources/{name}/schema/fields/{field}</code> — remove field (optional <code class="language-plaintext highlighter-rouge">force</code>; refused if integrity would be violated)</li>
      <li>
<code class="language-plaintext highlighter-rouge">PUT /{token}/v1/resources/{name}/schema/primaryKey</code> — set primary key (body: array of field names in order)</li>
      <li>
<code class="language-plaintext highlighter-rouge">POST /{token}/v1/resources/{name}/schema/foreignKeys</code> — add foreign key (body: fields, reference resource, reference fields; mirrors bus-data foreign-key add)</li>
      <li>
<code class="language-plaintext highlighter-rouge">DELETE /{token}/v1/resources/{name}/schema/foreignKeys/{index}</code> — remove foreign key by index</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">POST /{token}/v1/resources/{name}/validate</code> → validation report</li>
  <li>
<code class="language-plaintext highlighter-rouge">POST /{token}/v1/validate</code> → workspace validation report</li>
</ul>

<p>Resource and package mutation (subject to operation gating): resource add/remove/rename and package patch are supported; they delegate to bus-data (FR-API-012).</p>

<p>Row operations (resource-oriented). Single-row operations use the path segment <code class="language-plaintext highlighter-rouge">.../row/{pk}</code> (singular). Multi-row read uses <code class="language-plaintext highlighter-rouge">.../rows</code> (plural) with query parameters so that the contract is deterministic: one path shape for one row, another for multiple rows.</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">GET /{token}/v1/resources/{name}/rows</code></p>

    <ul>
      <li>Multi-row read. Query: <code class="language-plaintext highlighter-rouge">row</code>, <code class="language-plaintext highlighter-rouge">key</code>, <code class="language-plaintext highlighter-rouge">filter</code>, <code class="language-plaintext highlighter-rouge">column</code>, <code class="language-plaintext highlighter-rouge">include_formula_source</code> (mirrors bus-data library table-read semantics). For primary-key selection, use repeated <code class="language-plaintext highlighter-rouge">key</code> query params in schema primaryKey order (e.g. <code class="language-plaintext highlighter-rouge">?key=val1&amp;key=val2</code> for composite keys).</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">GET /{token}/v1/resources/{name}/row/{pk}</code></p>

    <ul>
      <li>Single-row read. <code class="language-plaintext highlighter-rouge">{pk}</code> is the percent-encoded JSON array of primary key values in schema primaryKey order (single-column primary key uses a one-element array, e.g. <code class="language-plaintext highlighter-rouge">["p-001"]</code>).</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">POST /{token}/v1/resources/{name}/rows</code> (add row)</li>
  <li>
<code class="language-plaintext highlighter-rouge">PATCH /{token}/v1/resources/{name}/row/{pk}</code> (update row, only if allowed)</li>
  <li>
<code class="language-plaintext highlighter-rouge">DELETE /{token}/v1/resources/{name}/row/{pk}</code> (delete row, only if allowed)</li>
</ul>

<p>Module-provided endpoints (FR-API-013). The API exposes bus-modules so that domain modules (e.g. bus-accounts) provide access to their data via their Go library. Module endpoints are path-based at <code class="language-plaintext highlighter-rouge">/{token}/v1/modules/{module}/...</code> (e.g. <code class="language-plaintext highlighter-rouge">/{token}/v1/modules/accounts/...</code> for bus-accounts). Only modules explicitly enabled via configuration or <code class="language-plaintext highlighter-rouge">--enable-module</code> are mounted; with none enabled, no module paths are served. Each backend implements <code class="language-plaintext highlighter-rouge">http.Handler</code> and receives requests with the capability and module prefix stripped (module-relative path). The OpenAPI document describes the combined surface for all enabled module backends.</p>

<p>All mutation endpoints are subject to operation gating (NFR-API-005); when restrictions such as <code class="language-plaintext highlighter-rouge">--read-only</code> are enabled, they return 403. When allowed, they MUST be atomic and MUST return deterministic error payloads. The normative error body shape for 4xx and 5xx responses includes at least: a stable machine-readable <code class="language-plaintext highlighter-rouge">code</code> string, <code class="language-plaintext highlighter-rouge">resource</code> (resource name when applicable), <code class="language-plaintext highlighter-rouge">field</code> or <code class="language-plaintext highlighter-rouge">fields</code> (field names when applicable), and <code class="language-plaintext highlighter-rouge">row</code> or <code class="language-plaintext highlighter-rouge">rowKey</code> (row identifier when applicable). Additional properties MAY be present for diagnostics; key ordering in JSON MUST be stable so that tests can compare payloads deterministically.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="data-design">Data Design</h3>

<p>Bus API does not introduce new on-disk data formats. It operates purely on the workspace datasets and metadata managed by <a href="./bus-data">bus-data</a> (CSV tables, beside-the-table schemas, and <code class="language-plaintext highlighter-rouge">datapackage.json</code>). The module does not own persistent storage for API state: the server is stateless aside from the workspace files it reads and writes through <a href="./bus-data">bus-data</a>. Mutation events are not persisted; they are emitted in-process to connected event-stream subscribers only and are lost when the connection closes or the server stops. Not Applicable: API-owned databases, caches, or session stores; all persistent data lives in the workspace.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="assumptions-and-dependencies">Assumptions and Dependencies</h3>

<p>AD-API-001 bus-data library. The module depends on the <a href="./bus-data">bus-data</a> Go library for all dataset, schema, and package operations. Integration is library-only (NFR-API-007): bus-api never invokes the bus-data CLI or any other Bus module CLI. If the library’s public API or error contracts change, bus-api must update its integration so that CRUD and validation outcomes remain consistent and deterministic.</p>

<p>AD-API-002 bus-bfl (transitive). Formula projection and validation are provided by <a href="./bus-data">bus-data</a>, which depends on the <a href="./bus-bfl">bus-bfl</a> Go library. bus-api does not call bus-bfl directly; formula behavior is entirely delegated to bus-data. Neither bus-api nor bus-data invokes the bus-bfl CLI; the dependency is library-only.</p>

<p>AD-API-003 Workspace on local filesystem. The selected workspace root is assumed to be a readable (and, for mutations, writable) directory on the local filesystem. The server does not support remote or network-mounted workspaces; if the root is missing or inaccessible, startup fails with a deterministic diagnostic.</p>

<p>AD-API-004 Go runtime. The module is built and run with a supported Go toolchain. Build and test environments assume a stable Go version as defined by the BusDK project.</p>

<p>AD-API-005 Single process. Concurrency safety (NFR-API-003) is defined for a single server process. Multi-instance or multi-process sharing of the same workspace is out of scope unless explicitly designed later; impact of false assumption: undefined behavior or data corruption if multiple writers access the same workspace.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="glossary-and-terminology">Glossary and Terminology</h3>

<p><strong>Capability URL:</strong> The full base URL printed at startup that includes the random token and port. Possession of this URL is treated as the sole authorization to access the API in the MVP.</p>

<p><strong>Token:</strong> The unguessable random path segment generated at startup and required in the path prefix of every request. It provides capability-style access control without stored credentials.</p>

<p><strong>Workspace root:</strong> The filesystem directory selected as the API’s working context (e.g. via <code class="language-plaintext highlighter-rouge">-C</code> / <code class="language-plaintext highlighter-rouge">--chdir</code>). All dataset and schema paths are resolved relative to this root; the server MUST NOT read or write outside it.</p>

<p><strong>Resource:</strong> A named tabular dataset in the workspace, as defined in the data package or discovered via beside-the-table schema conventions. In the API, resources are identified by name in path segments (e.g. <code class="language-plaintext highlighter-rouge">GET /{token}/v1/resources/{name}/schema</code>).</p>

<p><strong>Row / primary key (pk):</strong> A single row in a resource’s table, identified by the schema’s primary key. Single-row endpoints use the path segment <code class="language-plaintext highlighter-rouge">.../row/{pk}</code>; <code class="language-plaintext highlighter-rouge">{pk}</code> is the percent-encoded JSON array of primary key values in schema primaryKey order (single-column primary key uses a one-element array). Multi-row read uses <code class="language-plaintext highlighter-rouge">GET .../rows</code> with query parameters (e.g. repeated <code class="language-plaintext highlighter-rouge">key</code> in primaryKey order).</p>

<p><strong>Module backend:</strong> A bus-module Go library (e.g. bus-accounts) that registers with the bus-api server and provides handlers or resource views for module-owned data. The server delegates requests for that module’s URL space to the backend by calling its Go API in-process; the module uses its own library and may call bus-data. No CLI of any Bus module is ever executed (FR-API-013, NFR-API-007).</p>

<p><strong>Library-only integration:</strong> The requirement that bus-api (and, for module backends, any Bus module) integrate with other Bus modules solely by calling their Go libraries, never by executing their CLI binaries or subprocesses. See NFR-API-007 and KD-API-008.</p>

<p><strong>Event stream:</strong> A long-lived HTTP response (Server-Sent Events) at <code class="language-plaintext highlighter-rouge">GET /{token}/v1/events</code> that delivers mutation events to the client. Events are emitted only when mutations are performed through this API instance (row CRUD, schema or resource or package changes). See FR-API-014 and IF-API-004.</p>

<p><strong>Mutation event:</strong> A machine-readable JSON object pushed over the event stream describing a single change to workspace data (CSV or schema). It includes at least <code class="language-plaintext highlighter-rouge">type</code>, and optionally <code class="language-plaintext highlighter-rouge">resource</code>, <code class="language-plaintext highlighter-rouge">rowKey</code>, and <code class="language-plaintext highlighter-rouge">summary</code>. Used for change detection without polling.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="security-considerations">Security Considerations</h3>

<p>The server binds to loopback only by default (FR-API-003) and serves HTTP by default. When the operator supplies <code class="language-plaintext highlighter-rouge">--tls-cert</code> and <code class="language-plaintext highlighter-rouge">--tls-key</code>, the server serves HTTPS on the same listen address and port. In many deployments TLS is terminated by an external service (reverse proxy, load balancer) and the API runs HTTP behind it; optional in-process HTTPS is for operators who need it. The random token in the URL is treated as a bearer capability: anyone who has the full URL can access the API. The server must never serve files outside the workspace root and must reject path traversal attempts (FR-API-004). Request logging, if enabled, must avoid printing the token by default (e.g. log paths with the token redacted).</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="observability-and-logging">Observability and Logging</h3>

<p>Startup prints only the capability base URL to stdout. Diagnostics and logs go to stderr. Default logs SHOULD omit timestamps to keep outputs stable in tests; timestamps MAY be enabled explicitly.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="error-handling-and-resilience">Error Handling and Resilience</h3>

<p>Invalid usage exits with code 2 and a concise usage error. Runtime request failures return appropriate HTTP statuses with deterministic JSON error bodies conforming to the shape specified in the HTTP API Surface section. Any filesystem or validation failure must leave the workspace unchanged (NFR-API-010).</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="testing-strategy">Testing Strategy</h3>

<p>Unit tests MUST cover token path gating, workspace-root confinement, deterministic JSON ordering, and OpenAPI document validity. Integration tests MUST start the server with fixed <code class="language-plaintext highlighter-rouge">--token</code> and fixed <code class="language-plaintext highlighter-rouge">--port</code>, run CRUD and validation requests against a fixture workspace, and verify on-disk results match the equivalent <a href="./bus-data">bus-data</a> library operations (library-only integration; no CLI invocation). Integration tests for the event stream MUST verify that a client subscribed to <code class="language-plaintext highlighter-rouge">GET /{token}/v1/events</code> receives exactly one event (or the documented set of events) per successful mutating request, with payload shape conforming to IF-API-004, and that events are not emitted for failed or read-only requests. Concurrency tests MUST assert that two concurrent write requests serialize or reject deterministically without corrupting CSV files.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="deployment-and-operations">Deployment and Operations</h3>

<p>Not Applicable. The module ships as a single embedded binary intended for local use.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="migrationrollout">Migration/Rollout</h3>

<p>Not Applicable. The module is additive; it does not change dataset formats.</p>

<!-- busdk-docs-nav start -->
</div></section>
</div></section><div class="busdk-prev-next-bar"><div class="busdk-content-inner"><p class="busdk-prev-next">
  <span class="busdk-prev-next-item busdk-prev">← <a href="./bus-data">bus-data</a></span>
  <span class="busdk-prev-next-item busdk-index"><a href="./index">SDD index</a></span>
  <span class="busdk-prev-next-item busdk-next"><a href="./bus-dev">bus-dev</a> →</span>
</p></div></div>
<!-- busdk-docs-nav end -->

<div class="busdk-meta-block busdk-content-inner">
<div class="busdk-meta-section">
<h3 id="sources">Sources</h3>

<ul>
  <li><a href="https://docs.busdk.com/sdd">BusDK Software Design Document (SDD)</a></li>
  <li><a href="./bus-data">bus-data SDD</a></li>
  <li><a href="./bus-bfl">bus-bfl SDD</a></li>
  <li><a href="https://docs.busdk.com/cli/global-flags">Standard global flags</a></li>
  <li><a href="https://spec.openapis.org/oas/v3.1.0.html">OpenAPI Specification (OAS) 3.1</a></li>
</ul>

</div>
<div class="busdk-meta-section">
<h3 id="document-control">Document control</h3>

<p>Title: bus-api module SDD
Project: BusDK
Document ID: <code class="language-plaintext highlighter-rouge">BUSDK-MOD-API</code>
Version: 2026-02-13
Status: Draft
Last updated: 2026-02-13
Owner: BusDK development team</p>
</div>
</div>
          </div>
        </main>
      </div>

      
      <footer class="busdk-footer" role="contentinfo">
        <div class="busdk-footer-inner">
          <span class="busdk-footer-edit">This site is open source. <a href="https://github.com/busdk/docs/edit/gh-pages/sdd/bus-api.md">Improve this page</a>.</span>
          <span class="busdk-footer-copyright">&copy; 2026 <a href="https://hg.fi">Heusala Group Ltd</a></span>
        </div>
      </footer>
      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>

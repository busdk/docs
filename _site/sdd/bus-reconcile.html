<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>bus-reconcile — Software Design Document | BusDK Design Document</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="bus-reconcile — Software Design Document" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Bus Reconcile links bank transactions to invoices or journal entries, records allocations for partials, splits, and fees, and stores reconciliation records…" />
<meta property="og:description" content="Bus Reconcile links bank transactions to invoices or journal entries, records allocations for partials, splits, and fees, and stores reconciliation records…" />
<link rel="canonical" href="http://localhost:4000/sdd/bus-reconcile.html" />
<meta property="og:url" content="http://localhost:4000/sdd/bus-reconcile.html" />
<meta property="og:site_name" content="BusDK Design Document" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="bus-reconcile — Software Design Document" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Bus Reconcile links bank transactions to invoices or journal entries, records allocations for partials, splits, and fees, and stores reconciliation records…","headline":"bus-reconcile — Software Design Document","url":"http://localhost:4000/sdd/bus-reconcile.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=d739a5c055683d9701ead80f9ac87dbed78e5d75">
    <meta name="color-scheme" content="light dark">

<!-- Theme color for browser UI (light/dark). Keep in sync with busdk tokens. -->
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#0b0f14" media="(prefers-color-scheme: dark)">

  </head>
  <body class="busdk-docs-page">
    <div class="busdk-docs">
      <header class="busdk-site-header">
        <div class="busdk-site-header-inner">
          <a class="busdk-site-header-logo" href="/">BusDK Design Document</a>
        </div>
      </header>

      <div class="busdk-docs-body">
        
        <nav class="busdk-sidebar" aria-label="Documentation">
  <div class="busdk-sidebar-inner">
    <a class="busdk-sidebar-home" href="/">BusDK Design Document</a>
    <ul class="busdk-sidebar-nav">
      
      <li class="busdk-sidebar-section">
        <span class="busdk-sidebar-section-title">Get started</span>
        <ul class="busdk-sidebar-links">
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/overview/">Overview</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/design-goals/">Design goals and requirements</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/implementation/development-status">Development status</a>
          </li>
          
        </ul>
      </li>
      
      <li class="busdk-sidebar-section">
        <span class="busdk-sidebar-section-title">Design</span>
        <ul class="busdk-sidebar-links">
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link busdk-sidebar-link--current" href="/sdd/">Software Design Documents (SDD)</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/architecture/">System architecture</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/data/">Data formats and storage</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/layout/">Data directory layout</a>
          </li>
          
        </ul>
      </li>
      
      <li class="busdk-sidebar-section">
        <span class="busdk-sidebar-section-title">Workflows</span>
        <ul class="busdk-sidebar-links">
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/workflow/accounting-workflow-overview">Accounting workflow overview</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/workflow/">Example end-to-end workflow</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/cli/">CLI tooling and workflow</a>
          </li>
          
        </ul>
      </li>
      
      <li class="busdk-sidebar-section">
        <span class="busdk-sidebar-section-title">Reference</span>
        <ul class="busdk-sidebar-links">
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/master-data/">Master data (business objects)</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/modules/">Modules</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/integration/">Integration and future interfaces</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/extensibility/">Extensibility model</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/testing/">Testing</a>
          </li>
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/references/">References and foundations</a>
          </li>
          
        </ul>
      </li>
      
      <li class="busdk-sidebar-section">
        <span class="busdk-sidebar-section-title">Compliance</span>
        <ul class="busdk-sidebar-links">
          
          
          
          
          
          <li>
            <a class="busdk-sidebar-link" href="/compliance/fi-bookkeeping-and-tax-audit">Finnish bookkeeping and tax-audit</a>
          </li>
          
        </ul>
      </li>
      
    </ul>
  </div>
</nav>

        

        <main class="busdk-main busdk-main--with-sidebar">
          <div class="busdk-main-inner markdown-body">
            
            <header class="busdk-page-header">
              <div class="busdk-content-inner">
                <h1><a href="http://localhost:4000/">BusDK Design Document</a></h1>
              </div>
            </header>
            

            <section class="busdk-chapter busdk-chapter--level-2"><div class="busdk-chapter-inner">
<section class="busdk-chapter busdk-chapter--level-3 busdk-chapter--title"><div class="busdk-chapter-section-inner busdk-content-inner">
<h2 id="bus-reconcile">bus-reconcile</h2>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="introduction-and-overview">Introduction and Overview</h3>

<p>Bus Reconcile links bank transactions to invoices or journal entries, records allocations for partials, splits, and fees, and stores reconciliation records as schema-validated repository data.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="requirements">Requirements</h3>

<p>FR-REC-001 Reconciliation datasets. The module MUST store reconciliation records as schema-validated datasets with stable reconciliation identifiers. Acceptance criteria: reconciliations validate against schemas and preserve allocation history.</p>

<p>FR-REC-002 CLI surface for matching and allocation. The module MUST provide commands to match, allocate, and list reconciliations. Acceptance criteria: <code class="language-plaintext highlighter-rouge">match</code>, <code class="language-plaintext highlighter-rouge">allocate</code>, and <code class="language-plaintext highlighter-rouge">list</code> are available under <code class="language-plaintext highlighter-rouge">bus reconcile</code>.</p>

<p>NFR-REC-001 Auditability. Allocation history MUST be append-only and traceable to bank transactions, invoices, and vouchers. Acceptance criteria: allocation records are not overwritten and retain source references.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="system-architecture">System Architecture</h3>

<p>Bus Reconcile owns reconciliation datasets and integrates bank and invoice data to record matching outcomes. It links to the journal for ledger traceability and updates invoice status references.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="key-decisions">Key Decisions</h3>

<p>KD-REC-001 Reconciliation history is stored as repository data. Allocation changes are recorded as new rows to preserve the audit trail.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="component-design-and-interfaces">Component Design and Interfaces</h3>

<p>Interface IF-REC-001 (module CLI). The module exposes <code class="language-plaintext highlighter-rouge">bus reconcile</code> with subcommands <code class="language-plaintext highlighter-rouge">match</code>, <code class="language-plaintext highlighter-rouge">allocate</code>, and <code class="language-plaintext highlighter-rouge">list</code> and follows BusDK CLI conventions for deterministic output and diagnostics.</p>

<p>Documented parameters for <code class="language-plaintext highlighter-rouge">bus reconcile match</code> are <code class="language-plaintext highlighter-rouge">--bank-id &lt;id&gt;</code> and exactly one of <code class="language-plaintext highlighter-rouge">--invoice-id &lt;id&gt;</code> or <code class="language-plaintext highlighter-rouge">--journal-id &lt;id&gt;</code>. The command records a single reconciliation link between the specified bank transaction row from <code class="language-plaintext highlighter-rouge">bank-transactions.csv</code> and the target invoice header or journal transaction. Matching is deterministic and strict: the bank transaction amount and currency must equal the target amount as stored in the invoice header total or the journal transaction total, and the bank transaction must not already be reconciled. If these conditions are not met, the command exits non-zero and writes no reconciliation rows. Partial payments, splits, and fees are handled through <code class="language-plaintext highlighter-rouge">bus reconcile allocate</code> instead of <code class="language-plaintext highlighter-rouge">match</code>.</p>

<p>Documented parameters for <code class="language-plaintext highlighter-rouge">bus reconcile allocate</code> are <code class="language-plaintext highlighter-rouge">--bank-id &lt;id&gt;</code> plus one or more allocations expressed as repeatable <code class="language-plaintext highlighter-rouge">--invoice &lt;id&gt;=&lt;amount&gt;</code> and <code class="language-plaintext highlighter-rouge">--journal &lt;id&gt;=&lt;amount&gt;</code> flags. Allocation flags may appear in any order, and each allocation row references the stable invoice identifier or the stable journal transaction identifier as stored in their datasets. Allocation amounts are positive decimals expressed in the same currency as the bank transaction row, and the sum of all allocations must equal the bank transaction amount exactly. If any referenced record does not exist or the amounts do not sum exactly, the command exits non-zero and writes no reconciliation rows.</p>

<p>Usage examples:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bus reconcile match
bus reconcile allocate <span class="nt">--bank-id</span> BANK-001 <span class="nt">--invoice</span> INV-1001<span class="o">=</span>900 <span class="nt">--journal</span> JRN-2026-014<span class="o">=</span>40 <span class="nt">--journal</span> JRN-2026-015<span class="o">=</span>300
bus reconcile list
</code></pre></div></div>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="data-design">Data Design</h3>

<p>The module reads and writes reconciliation datasets in the reconciliation area, with JSON Table Schemas stored beside each CSV dataset. Master data owned by this module is stored in the workspace root only; the module does not create or use a <code class="language-plaintext highlighter-rouge">reconcile/</code> or other subdirectory for its datasets and schemas. It consumes bank transactions and invoice references as inputs.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="assumptions-and-dependencies">Assumptions and Dependencies</h3>

<p>Bus Reconcile depends on <code class="language-plaintext highlighter-rouge">bus bank</code> transaction data, <code class="language-plaintext highlighter-rouge">bus invoices</code> references, and the workspace layout and schema conventions. Missing datasets or schemas result in deterministic diagnostics.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="security-considerations">Security Considerations</h3>

<p>Reconciliation data is repository data and should be protected by repository access controls. Evidence references remain intact for auditability.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="observability-and-logging">Observability and Logging</h3>

<p>Command results are written to standard output, and diagnostics are written to standard error with deterministic references to dataset paths and identifiers.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="error-handling-and-resilience">Error Handling and Resilience</h3>

<p>Invalid usage exits with a non-zero status and a concise usage error. Schema or reference violations exit non-zero without modifying datasets.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="testing-strategy">Testing Strategy</h3>

<p>Unit tests cover matching and allocation logic, and command-level tests exercise <code class="language-plaintext highlighter-rouge">match</code>, <code class="language-plaintext highlighter-rouge">allocate</code>, and <code class="language-plaintext highlighter-rouge">list</code> against fixture workspaces.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="deployment-and-operations">Deployment and Operations</h3>

<p>Not Applicable. The module ships as a BusDK CLI component and relies on the standard workspace layout.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="migrationrollout">Migration/Rollout</h3>

<p>Not Applicable. Schema evolution is handled through the standard schema migration workflow for workspace datasets.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="risks">Risks</h3>

<p>Not Applicable. Module-specific risks are not enumerated beyond the general need for deterministic reconciliation data handling.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="glossary-and-terminology">Glossary and Terminology</h3>

<p>Reconciliation record: a dataset row linking a bank transaction to an invoice or journal entry.<br>
Allocation history: append-only records detailing partials, splits, and fees.</p>

<hr>

<!-- busdk-docs-nav start -->
</div></section>
</div></section><div class="busdk-prev-next-bar"><div class="busdk-content-inner"><p class="busdk-prev-next">
  <span class="busdk-prev-next-item busdk-prev">← <a href="./bus-bank">bus-bank</a></span>
  <span class="busdk-prev-next-item busdk-index"><a href="./index">SDD index</a></span>
  <span class="busdk-prev-next-item busdk-next"><a href="./bus-assets">bus-assets</a> →</span>
</p></div></div>
<!-- busdk-docs-nav end -->

<div class="busdk-meta-block busdk-content-inner">
<div class="busdk-meta-section">
<h3 id="sources">Sources</h3>

<ul>
  <li><a href="../master-data/bank-transactions/index">Master data: Bank transactions</a></li>
  <li><a href="../master-data/sales-invoices/index">Master data: Sales invoices</a></li>
  <li><a href="../master-data/purchase-invoices/index">Master data: Purchase invoices</a></li>
  <li><a href="../modules/bus-reconcile">End user documentation: bus-reconcile CLI reference</a></li>
  <li><a href="https://github.com/busdk/bus-reconcile">Repository</a></li>
  <li><a href="../workflow/import-bank-transactions-and-apply-payment">Import bank transactions and apply payment</a></li>
  <li><a href="../workflow/accounting-workflow-overview">Accounting workflow overview</a></li>
</ul>

</div>
<div class="busdk-meta-section">
<h3 id="document-control">Document control</h3>

<p>Title: bus-reconcile module SDD<br>
Project: BusDK<br>
Document ID: <code class="language-plaintext highlighter-rouge">BUSDK-MOD-RECONCILE</code><br>
Version: 2026-02-07<br>
Status: Draft<br>
Last updated: 2026-02-07<br>
Owner: BusDK development team</p>
</div>
</div>
          </div>
        </main>
      </div>

      
      <footer class="busdk-footer" role="contentinfo">
        <div class="busdk-footer-inner">
          <span class="busdk-footer-edit">This site is open source. <a href="https://github.com/busdk/docs/edit/gh-pages/sdd/bus-reconcile.md">Improve this page</a>.</span>
          <span class="busdk-footer-copyright">&copy; 2026 <a href="https://hg.fi">Heusala Group Ltd</a></span>
        </div>
      </footer>
      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>

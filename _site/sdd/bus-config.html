<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>bus-config — workspace and user configuration, accounting entity settings (SDD) | BusDK Design Document</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="bus-config — workspace and user configuration, accounting entity settings (SDD)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Bus Config owns workspace-level configuration stored in datapackage.json at the workspace root." />
<meta property="og:description" content="Bus Config owns workspace-level configuration stored in datapackage.json at the workspace root." />
<link rel="canonical" href="http://localhost:4000/sdd/bus-config.html" />
<meta property="og:url" content="http://localhost:4000/sdd/bus-config.html" />
<meta property="og:site_name" content="BusDK Design Document" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="bus-config — workspace and user configuration, accounting entity settings (SDD)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Bus Config owns workspace-level configuration stored in datapackage.json at the workspace root.","headline":"bus-config — workspace and user configuration, accounting entity settings (SDD)","url":"http://localhost:4000/sdd/bus-config.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=75995bd36d97e180d883903e5860ec99f62566a0">
    <meta name="color-scheme" content="light dark">

<!-- Theme color for browser UI (light/dark). Keep in sync with busdk tokens. -->
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#0b0f14" media="(prefers-color-scheme: dark)">

  </head>
  <body class="busdk-docs-page">
    <div class="busdk-docs">
      <header class="busdk-site-header">
        <div class="busdk-site-header-inner">
          <a class="busdk-site-header-logo" href="/">BusDK Design Document</a>
        </div>
      </header>

      <div class="busdk-docs-body">
        
        <nav class="busdk-sidebar" aria-label="Documentation">
  <div class="busdk-sidebar-inner">
    <a class="busdk-sidebar-home" href="/">BusDK Design Document</a>
    <ul class="busdk-sidebar-nav">
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel">
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Get started</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/overview/">Overview</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/design-goals/">Design goals and requirements</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/implementation/development-status">Development status</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel">
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Workflows</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/workflow/accounting-workflow-overview">Accounting workflow overview</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/workflow/">Example end-to-end workflow</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/cli/">CLI tooling and workflow</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel">
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Modules</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/">Modules overview</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus">bus</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-init">bus init</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-config">bus config</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-data">bus data</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-api">bus api</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-sheets">bus sheets</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-dev">bus dev</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-agent">bus agent</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-bfl">bus bfl</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-accounts">bus accounts</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-entities">bus entities</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-period">bus period</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-preferences">bus preferences</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-attachments">bus attachments</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-invoices">bus invoices</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-journal">bus journal</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-bank">bus bank</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-reconcile">bus reconcile</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-assets">bus assets</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-loans">bus loans</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-inventory">bus inventory</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-payroll">bus payroll</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-budget">bus budget</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-reports">bus reports</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-validate">bus validate</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-vat">bus vat</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-pdf">bus pdf</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-filing">bus filing</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-filing-prh">bus filing prh</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-filing-vero">bus filing vero</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel" open>
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Software Design Documents</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link busdk-sidebar-link--current" href="/sdd/">SDD overview</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link busdk-sidebar-link--current" href="/sdd/bus">bus</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-init">bus init</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link busdk-sidebar-link--current" href="/sdd/bus-config">bus config</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-data">bus data</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-api">bus api</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-sheets">bus sheets</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-dev">bus dev</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-agent">bus agent</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-bfl">bus bfl</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-accounts">bus accounts</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-entities">bus entities</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-period">bus period</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-preferences">bus preferences</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-attachments">bus attachments</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-invoices">bus invoices</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-journal">bus journal</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-bank">bus bank</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-reconcile">bus reconcile</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-assets">bus assets</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-loans">bus loans</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-inventory">bus inventory</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-payroll">bus payroll</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-budget">bus budget</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-reports">bus reports</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-validate">bus validate</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-vat">bus vat</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-pdf">bus pdf</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-filing">bus filing</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-filing-prh">bus filing prh</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-filing-vero">bus filing vero</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel">
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Design</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/architecture/">System architecture</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/data/">Data formats and storage</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/layout/">Data directory layout</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel">
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Reference</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/master-data/">Master data</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/integration/">Integration and future interfaces</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/extensibility/">Extensibility model</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/testing/">Testing</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/references/">References and foundations</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel">
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Compliance</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/compliance/fi-bookkeeping-and-tax-audit">Finnish bookkeeping and tax-audit</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/compliance/fi-company-reorganisation-evidence-pack">Finnish company reorganisation (yrityssaneeraus)</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
    </ul>
  </div>
</nav>

        

        <main class="busdk-main busdk-main--with-sidebar">
          <div class="busdk-main-inner markdown-body">
            
            <header class="busdk-page-header">
              <div class="busdk-content-inner">
                <h1>bus-config — workspace and user configuration, accounting entity settings (SDD)</h1>
              </div>
            </header>
            

            <section class="busdk-chapter busdk-chapter--level-2"><div class="busdk-chapter-inner">
<section class="busdk-chapter busdk-chapter--level-3 busdk-chapter--title"><div class="busdk-chapter-section-inner busdk-content-inner">
<h2 id="bus-config--workspace-and-user-configuration-accounting-entity-settings">bus-config — workspace and user configuration, accounting entity settings</h2>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="introduction-and-overview">Introduction and Overview</h3>

<p>Bus Config owns workspace-level configuration stored in <code class="language-plaintext highlighter-rouge">datapackage.json</code> at the workspace root and, separately, user-level bus configuration stored in a dedicated config file (e.g. in the user’s config directory). The workspace descriptor holds the BusDK extension metadata (the <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code> object) that defines accounting entity settings — base currency, fiscal year boundaries, VAT registration, and VAT reporting cadence. Other modules read these settings when they validate, post, reconcile, report, or produce filings. The user-level bus configuration holds preferences that apply across invocations and contexts, such as the default agent runtime for <a href="./bus-agent">bus-agent</a> and <a href="./bus-dev">bus-dev</a>; the <a href="./bus-agent">bus-agent</a> module uses the bus-config Go library to read and write this preference so that the chosen agent is saved in bus configuration.</p>

<p>The module provides a dedicated CLI surface for configuration so that editing workspace settings is separate from bootstrapping a new workspace, and so that users can set and persist options like the default agent. Bootstrap is orchestrated by <a href="./bus-init">bus-init</a>, which invokes <code class="language-plaintext highlighter-rouge">bus config init</code> first to create or ensure <code class="language-plaintext highlighter-rouge">datapackage.json</code>; when the user supplies module-include flags, it then runs each selected domain module’s <code class="language-plaintext highlighter-rouge">init</code>. Bus Config is the sole owner of the workspace configuration file and the accounting entity subtree; it also owns the user-level bus configuration file and exposes a Go library so that other modules (e.g. bus-agent) can read and write persistent preferences without duplicating config logic. It does not own domain datasets (chart of accounts, parties, journals, and so on), which remain owned by their respective modules.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="requirements">Requirements</h3>

<p>FR-CFG-001 Workspace configuration creation. The module MUST provide an <code class="language-plaintext highlighter-rouge">init</code> command that creates or ensures <code class="language-plaintext highlighter-rouge">datapackage.json</code> at the workspace root with a valid <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code> object. When the file already exists and already contains <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code>, <code class="language-plaintext highlighter-rouge">init</code> MUST print a warning to standard error and exit with code 0 without modifying the file. When the file is missing or does not contain <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code>, <code class="language-plaintext highlighter-rouge">init</code> MUST create or update it so that the descriptor conforms to the <a href="../data/workspace-configuration">workspace configuration</a> shape. Acceptance criteria: running <code class="language-plaintext highlighter-rouge">bus config init</code> in an empty directory creates <code class="language-plaintext highlighter-rouge">datapackage.json</code> with default accounting entity settings; running it again yields a warning and no write; running it in a directory that has a minimal data package without the BusDK extension adds the <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code> subtree with defaults.</p>

<p>FR-CFG-002 Accounting entity settings update. The module MUST support updating accounting entity properties in an existing workspace <code class="language-plaintext highlighter-rouge">datapackage.json</code> without re-running init. Acceptance criteria: <code class="language-plaintext highlighter-rouge">bus config configure</code> accepts flags for each property (<code class="language-plaintext highlighter-rouge">base_currency</code>, <code class="language-plaintext highlighter-rouge">fiscal_year_start</code>, <code class="language-plaintext highlighter-rouge">fiscal_year_end</code>, <code class="language-plaintext highlighter-rouge">vat_registered</code>, <code class="language-plaintext highlighter-rouge">vat_reporting_period</code>); only provided flags alter the stored value; the command fails with a clear error if <code class="language-plaintext highlighter-rouge">datapackage.json</code> does not exist or does not contain <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code>.</p>

<p>FR-CFG-003 Non-invasive operation. The module MUST not perform Git or network operations. Acceptance criteria: all commands only read and write the workspace <code class="language-plaintext highlighter-rouge">datapackage.json</code> (and only the BusDK extension subtree where applicable).</p>

<p>FR-CFG-004 Deterministic output. The module MUST emit deterministic diagnostics and fail with a clear message when preconditions are not met. Acceptance criteria: invalid usage or missing preconditions produce a deterministic error to standard error and a non-zero exit code.</p>

<p>NFR-CFG-001 Schema conformance. Flag values for <code class="language-plaintext highlighter-rouge">configure</code> MUST conform to the canonical schema in <a href="../data/workspace-configuration">Workspace configuration (<code class="language-plaintext highlighter-rouge">datapackage.json</code> extension)</a>. Invalid values produce a deterministic usage error and exit code 2.</p>

<p>FR-CFG-005 Bus configuration Go library. The module MUST provide a Go package that other modules can import to read and write bus configuration. The library MUST expose at least the ability to get and set the default agent runtime (the persistent preference used by <a href="./bus-agent">bus-agent</a> for resolution step (3) in FR-AGT-005). The storage location for user-level bus configuration (e.g. user config directory or file path) is defined and documented by bus-config; the library MUST use that location so that all modules share the same persistent preference. Acceptance criteria: bus-agent can import the bus-config package, call a function to read the default agent, and call a function to write the default agent; the written value persists across process invocations and is used by bus-agent when no per-call or session preference is set.</p>

<p>FR-CFG-006 Default agent CLI. The module MUST provide a CLI surface so that the user can set which agent runtime is used by default and have that choice saved in bus configuration. At minimum, a subcommand or flag (e.g. <code class="language-plaintext highlighter-rouge">bus config set agent &lt;runtime&gt;</code> or <code class="language-plaintext highlighter-rouge">bus config configure --agent &lt;runtime&gt;</code>) MUST write the given runtime identifier to the bus configuration via the module’s own library; invalid runtime names (e.g. not one of the supported runtimes documented by bus-agent) MUST produce a usage error and exit 2. The module MAY provide a way to display the current default agent (e.g. <code class="language-plaintext highlighter-rouge">bus config get agent</code> or as part of <code class="language-plaintext highlighter-rouge">bus config show</code>). Acceptance criteria: running the set command persists the value; a subsequent invocation of <code class="language-plaintext highlighter-rouge">bus dev</code> or <code class="language-plaintext highlighter-rouge">bus agent run</code> without <code class="language-plaintext highlighter-rouge">--agent</code> or session preference uses that persisted value when bus-agent reads it from the bus-config library.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="system-architecture">System Architecture</h3>

<p>Bus Config is a small CLI module with a Go library that reads and writes workspace configuration (<code class="language-plaintext highlighter-rouge">datapackage.json</code>) and user-level bus configuration (a dedicated config file). The CLI is invoked directly by users when they want to create or change accounting entity settings or set the default agent; it is invoked by bus-init during bootstrap to ensure the workspace descriptor exists before domain module inits run. The bus-config library is imported by <a href="./bus-agent">bus-agent</a> (and thus indirectly by bus-dev) to read and optionally write the persistent default agent preference; bus-agent does not implement its own config file or location. Bus Config has no internal subprocess calls beyond the normal dependency on the <code class="language-plaintext highlighter-rouge">bus</code> dispatcher; it does not invoke other BusDK modules for configuration.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="key-decisions">Key Decisions</h3>

<p>KD-CFG-001 Configuration as a dedicated module. Workspace configuration is owned by bus-config rather than bus-init so that the CLI surface is simplified: <code class="language-plaintext highlighter-rouge">bus init</code> means “bootstrap a new workspace,” and <code class="language-plaintext highlighter-rouge">bus config</code> means “create or edit workspace configuration.” Users and scripts can run <code class="language-plaintext highlighter-rouge">bus config configure</code> without implying re-initialization.</p>

<p>KD-CFG-002 Init idempotency. <code class="language-plaintext highlighter-rouge">bus config init</code> is idempotent when the workspace already has a valid <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code> object. It does not overwrite existing configuration, which avoids accidental loss of user settings during re-runs or scripting.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="component-design-and-interfaces">Component Design and Interfaces</h3>

<p>Interface IF-CFG-001 (init). The module is invoked as <code class="language-plaintext highlighter-rouge">bus config init</code> and follows BusDK CLI conventions for deterministic output and diagnostics. The command accepts no positional arguments and no module-specific flags beyond the shared global flags. It creates or updates <code class="language-plaintext highlighter-rouge">datapackage.json</code> at the effective workspace root (current directory or the directory given by <code class="language-plaintext highlighter-rouge">-C</code> / <code class="language-plaintext highlighter-rouge">--chdir</code>). When the file already contains <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code>, it exits 0 and prints a warning to stderr without writing.</p>

<p>Interface IF-CFG-002 (configure). The module is invoked as <code class="language-plaintext highlighter-rouge">bus config configure</code> and updates accounting entity settings in an existing workspace <code class="language-plaintext highlighter-rouge">datapackage.json</code>. The command requires a workspace that already contains <code class="language-plaintext highlighter-rouge">datapackage.json</code> with a <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code> object. It accepts optional flags: <code class="language-plaintext highlighter-rouge">--base-currency</code>, <code class="language-plaintext highlighter-rouge">--fiscal-year-start</code>, <code class="language-plaintext highlighter-rouge">--fiscal-year-end</code>, <code class="language-plaintext highlighter-rouge">--vat-registered</code>, <code class="language-plaintext highlighter-rouge">--vat-reporting-period</code>. Only flags explicitly provided are written; other properties remain unchanged. Flag values must conform to the canonical schema; invalid values produce a deterministic usage error and exit code 2.</p>

<p>Interface IF-CFG-003 (bus configuration library). The module exposes a Go package that provides at least: (1) a function to read the default agent runtime from bus configuration (returns the stored value or empty if unset); (2) a function to write the default agent runtime to bus configuration (persists to the user-level config file). The library MAY also expose get/set for agent order and enable/disable so that bus-agent can read them for FR-AGT-005a; if so, the resolution order between library-provided values and environment variables is documented in bus-agent. The storage path for user-level bus configuration is implementation-defined but MUST be documented and MUST be the same for all consumers (e.g. under the user’s config directory). bus-agent MUST use this library for persistent preference (FR-AGT-005 step (3)); it MUST NOT define a separate config file or path for the same purpose.</p>

<p>Interface IF-CFG-004 (set agent CLI). The module is invoked as <code class="language-plaintext highlighter-rouge">bus config set agent &lt;runtime&gt;</code> (or equivalent) to persist the default agent runtime to bus configuration. The <code class="language-plaintext highlighter-rouge">&lt;runtime&gt;</code> value MUST be one of the runtime identifiers supported by bus-agent (e.g. <code class="language-plaintext highlighter-rouge">cursor</code>, <code class="language-plaintext highlighter-rouge">codex</code>, <code class="language-plaintext highlighter-rouge">gemini</code>, <code class="language-plaintext highlighter-rouge">claude</code>). Invalid values produce exit code 2. The command MUST write the value using the bus-config library so that it is stored in the same location the library reads from. The module MAY expose <code class="language-plaintext highlighter-rouge">bus config get agent</code> (or equivalent) to print the current default agent to stdout.</p>

<p>Usage examples:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bus config init
bus config configure <span class="nt">--base-currency</span><span class="o">=</span>EUR <span class="nt">--vat-registered</span><span class="o">=</span><span class="nb">true
</span>bus config <span class="nb">set </span>agent gemini
bus config get agent
</code></pre></div></div>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="data-design">Data Design</h3>

<p>The module owns two configuration layers. (1) <strong>Workspace configuration:</strong> <code class="language-plaintext highlighter-rouge">datapackage.json</code> at the workspace root. The descriptor contains both the Frictionless resource manifest and BusDK workspace-level configuration via the <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code> extension. The <code class="language-plaintext highlighter-rouge">init</code> command creates the file or ensures the <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code> subtree exists with default values; the <code class="language-plaintext highlighter-rouge">configure</code> command updates only the properties specified by flags. (2) <strong>User-level bus configuration:</strong> a dedicated config file (e.g. in the user’s config directory) that stores preferences that apply across invocations and contexts, including the default agent runtime used by bus-agent. The library reads and writes this file; the CLI commands <code class="language-plaintext highlighter-rouge">bus config set agent</code> and <code class="language-plaintext highlighter-rouge">bus config get agent</code> (or equivalent) operate on the same file. The exact path and format of the user-level config file are implementation-defined and documented so that bus-agent and other consumers use the library rather than reading the file directly. The module does not create or modify domain datasets (accounts, entities, journals, etc.); those are owned by other modules.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="assumptions-and-dependencies">Assumptions and Dependencies</h3>

<p>Bus Config depends on the standard workspace layout for workspace commands: the effective workspace root is the directory where <code class="language-plaintext highlighter-rouge">datapackage.json</code> is expected. It assumes the <code class="language-plaintext highlighter-rouge">bus</code> dispatcher is available when invoked. When invoked by bus-init during bootstrap, bus-config init runs before any domain module init so that the descriptor exists for modules that read it. The <a href="./bus-agent">bus-agent</a> module depends on the bus-config Go library for reading and writing the persistent default agent; bus-config does not depend on bus-agent at build time, but the CLI’s <code class="language-plaintext highlighter-rouge">set agent</code> command validates runtime names against the set of runtimes that bus-agent supports (so that invalid values are rejected).</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="security-considerations">Security Considerations</h3>

<p>The module only reads and writes the workspace descriptor. Access controls are handled at the repository and filesystem level.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="observability-and-logging">Observability and Logging</h3>

<p>Command results are written to standard output when applicable; diagnostics and warnings are written to standard error with deterministic messages.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="error-handling-and-resilience">Error Handling and Resilience</h3>

<p>Invalid usage or missing preconditions (e.g. <code class="language-plaintext highlighter-rouge">datapackage.json</code> not found, or <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code> missing for <code class="language-plaintext highlighter-rouge">configure</code>) result in a non-zero exit and a concise error on stderr.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="testing-strategy">Testing Strategy</h3>

<p>Command-level tests exercise <code class="language-plaintext highlighter-rouge">bus config init</code> and <code class="language-plaintext highlighter-rouge">bus config configure</code> against fixture workspaces and verify that the descriptor is created or updated as specified and that idempotency and precondition checks behave as required.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="deployment-and-operations">Deployment and Operations</h3>

<p>Not Applicable. The module ships as a BusDK CLI component and relies on the standard workspace layout.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="migrationrollout">Migration/Rollout</h3>

<p>Not Applicable. Existing workspaces that already have <code class="language-plaintext highlighter-rouge">datapackage.json</code> with <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code> are unchanged; they can use <code class="language-plaintext highlighter-rouge">bus config configure</code> from the new module instead of the previous <code class="language-plaintext highlighter-rouge">bus init configure</code> command.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="risks">Risks</h3>

<p>Not Applicable beyond the need for deterministic, repeatable behavior when reading and writing the descriptor.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="glossary-and-terminology">Glossary and Terminology</h3>

<p><strong>Workspace configuration:</strong> the contents of <code class="language-plaintext highlighter-rouge">datapackage.json</code> at the workspace root, including the BusDK extension <code class="language-plaintext highlighter-rouge">busdk.accounting_entity</code>.</p>

<p><strong>Accounting entity settings:</strong> the set of properties (base currency, fiscal year, VAT registration, VAT reporting period) that apply to the whole workspace and are read by other modules.</p>

<p><strong>Bus configuration:</strong> the union of workspace configuration and user-level bus configuration. User-level bus configuration is stored in a dedicated file (e.g. in the user’s config directory) and holds preferences that apply across invocations, such as the default agent runtime. The <a href="./bus-agent">bus-agent</a> module reads and writes the default agent via the bus-config Go library so that the chosen agent is saved in bus configuration.</p>

<p><strong>Default agent:</strong> the persistent preference for which agent runtime (cursor, codex, gemini, claude) to use when no per-command or session preference is set. Stored in user-level bus configuration and read by bus-agent through the bus-config library.</p>

<hr>

<!-- busdk-docs-nav start -->
</div></section>
</div></section><div class="busdk-prev-next-bar"><div class="busdk-content-inner"><p class="busdk-prev-next">
  <span class="busdk-prev-next-item busdk-prev">← <a href="./bus-init">bus-init</a></span>
  <span class="busdk-prev-next-item busdk-index"><a href="./index">SDD index</a></span>
  <span class="busdk-prev-next-item busdk-next"><a href="./bus-data">bus-data</a> →</span>
</p></div></div>
<!-- busdk-docs-nav end -->

<div class="busdk-meta-block busdk-content-inner">
<div class="busdk-meta-section">
<h3 id="sources">Sources</h3>

<ul>
  <li><a href="../data/workspace-configuration">Workspace configuration (<code class="language-plaintext highlighter-rouge">datapackage.json</code> extension)</a></li>
  <li><a href="../master-data/accounting-entity/index">Master data: Accounting entity</a></li>
  <li><a href="../modules/bus-config">End user documentation: bus-config CLI reference</a></li>
  <li><a href="./bus-agent">bus-agent module SDD</a></li>
  <li><a href="../workflow/initialize-repo">Initialize repo</a></li>
  <li><a href="../layout/layout-principles">Layout principles</a></li>
</ul>

</div>
<div class="busdk-meta-section">
<h3 id="document-control">Document control</h3>

<p>Title: bus-config module SDD<br>
Project: BusDK<br>
Document ID: <code class="language-plaintext highlighter-rouge">BUSDK-MOD-CFG</code><br>
Version: 2026-02-12<br>
Status: Draft<br>
Last updated: 2026-02-12<br>
Owner: BusDK development team</p>
</div>
</div>
          </div>
        </main>
      </div>

      
      <footer class="busdk-footer" role="contentinfo">
        <div class="busdk-footer-inner">
          <span class="busdk-footer-edit">This site is open source. <a href="https://github.com/busdk/docs/edit/gh-pages/sdd/bus-config.md">Improve this page</a>.</span>
          <span class="busdk-footer-copyright">&copy; 2026 <a href="https://hg.fi">Heusala Group Ltd</a></span>
        </div>
      </footer>
      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>

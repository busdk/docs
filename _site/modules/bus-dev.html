<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>bus-dev | BusDK Design Document</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="bus-dev" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="bus dev is a developer-only companion that centralizes workflow logic that module repositories would otherwise duplicate in scripts/: module scaffolding, AGENTS.md creation and refinement, commit workflows, planning, agent-runner workflows, and e2e test scaffolding." />
<meta property="og:description" content="bus dev is a developer-only companion that centralizes workflow logic that module repositories would otherwise duplicate in scripts/: module scaffolding, AGENTS.md creation and refinement, commit workflows, planning, agent-runner workflows, and e2e test scaffolding." />
<link rel="canonical" href="http://localhost:4000/modules/bus-dev.html" />
<meta property="og:url" content="http://localhost:4000/modules/bus-dev.html" />
<meta property="og:site_name" content="BusDK Design Document" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="bus-dev" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"bus dev is a developer-only companion that centralizes workflow logic that module repositories would otherwise duplicate in scripts/: module scaffolding, AGENTS.md creation and refinement, commit workflows, planning, agent-runner workflows, and e2e test scaffolding.","headline":"bus-dev","url":"http://localhost:4000/modules/bus-dev.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=75995bd36d97e180d883903e5860ec99f62566a0">
    <meta name="color-scheme" content="light dark">

<!-- Theme color for browser UI (light/dark). Keep in sync with busdk tokens. -->
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#0b0f14" media="(prefers-color-scheme: dark)">

  </head>
  <body class="busdk-docs-page">
    <div class="busdk-docs">
      <header class="busdk-site-header">
        <div class="busdk-site-header-inner">
          <a class="busdk-site-header-logo" href="/">BusDK Design Document</a>
        </div>
      </header>

      <div class="busdk-docs-body">
        
        <nav class="busdk-sidebar" aria-label="Documentation">
  <div class="busdk-sidebar-inner">
    <a class="busdk-sidebar-home" href="/">BusDK Design Document</a>
    <ul class="busdk-sidebar-nav">
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel">
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Get started</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/overview/">Overview</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/design-goals/">Design goals and requirements</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/implementation/development-status">Development status</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel">
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Workflows</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/workflow/accounting-workflow-overview">Accounting workflow overview</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/workflow/">Example end-to-end workflow</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/cli/">CLI tooling and workflow</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel" open>
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Modules</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link busdk-sidebar-link--current" href="/modules/">Modules overview</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link busdk-sidebar-link--current" href="/modules/bus">bus</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-init">bus init</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-config">bus config</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-data">bus data</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-api">bus api</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-sheets">bus sheets</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link busdk-sidebar-link--current" href="/modules/bus-dev">bus dev</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-agent">bus agent</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-bfl">bus bfl</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-accounts">bus accounts</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-entities">bus entities</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-period">bus period</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-preferences">bus preferences</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-attachments">bus attachments</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-invoices">bus invoices</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-journal">bus journal</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-bank">bus bank</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-reconcile">bus reconcile</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-assets">bus assets</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-loans">bus loans</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-inventory">bus inventory</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-payroll">bus payroll</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-budget">bus budget</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-reports">bus reports</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-validate">bus validate</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-vat">bus vat</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-pdf">bus pdf</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-filing">bus filing</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-filing-prh">bus filing prh</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/modules/bus-filing-vero">bus filing vero</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel">
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Software Design Documents</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/">SDD overview</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus">bus</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-init">bus init</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-config">bus config</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-data">bus data</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-api">bus api</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-sheets">bus sheets</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-dev">bus dev</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-agent">bus agent</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-bfl">bus bfl</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-accounts">bus accounts</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-entities">bus entities</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-period">bus period</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-preferences">bus preferences</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-attachments">bus attachments</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-invoices">bus invoices</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-journal">bus journal</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-bank">bus bank</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-reconcile">bus reconcile</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-assets">bus assets</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-loans">bus loans</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-inventory">bus inventory</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-payroll">bus payroll</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-budget">bus budget</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-reports">bus reports</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-validate">bus validate</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-vat">bus vat</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-pdf">bus pdf</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-filing">bus filing</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-filing-prh">bus filing prh</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/sdd/bus-filing-vero">bus filing vero</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel">
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Design</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/architecture/">System architecture</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/data/">Data formats and storage</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/layout/">Data directory layout</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel">
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Reference</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/master-data/">Master data</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/integration/">Integration and future interfaces</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/extensibility/">Extensibility model</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/testing/">Testing</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/references/">References and foundations</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
      
      
      <li class="busdk-sidebar-section">
        <details class="busdk-sidebar-section-panel">
          <summary class="busdk-sidebar-section-toggle">
            <span class="busdk-sidebar-section-title">Compliance</span>
            <span class="busdk-sidebar-section-chevron" aria-hidden="true">▸</span>
          </summary>
          <ul class="busdk-sidebar-links">
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/compliance/fi-bookkeeping-and-tax-audit">Finnish bookkeeping and tax-audit</a>
              
            </li>
            
            
            
            
            

            
            

            <li class="busdk-sidebar-item">
              <a class="busdk-sidebar-link" href="/compliance/fi-company-reorganisation-evidence-pack">Finnish company reorganisation (yrityssaneeraus)</a>
              
            </li>
            
          </ul>
        </details>
      </li>
      
    </ul>
  </div>
</nav>

        

        <main class="busdk-main busdk-main--with-sidebar">
          <div class="busdk-main-inner markdown-body">
            
            <header class="busdk-page-header">
              <div class="busdk-content-inner">
                <h1>bus-dev</h1>
              </div>
            </header>
            

            <section class="busdk-chapter busdk-chapter--level-2"><div class="busdk-chapter-inner">
<section class="busdk-chapter busdk-chapter--level-3 busdk-chapter--title"><div class="busdk-chapter-section-inner busdk-content-inner">
<h2 id="bus-dev--developer-workflows-for-busdk-module-repositories">
<code class="language-plaintext highlighter-rouge">bus-dev</code> — developer workflows for BusDK module repositories</h2>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="synopsis">Synopsis</h3>

<p><code class="language-plaintext highlighter-rouge">bus dev [-h] [-V] [-v] [-q] [-C &lt;dir&gt;] [-o &lt;file&gt;] [--color &lt;auto|always|never&gt;] [--no-color] [--agent &lt;cursor|codex|gemini|claude&gt;] &lt;operation&gt; [operation ...]</code></p>

<p>Operations: <strong><code class="language-plaintext highlighter-rouge">init</code></strong>, <strong><code class="language-plaintext highlighter-rouge">commit</code></strong>, <strong><code class="language-plaintext highlighter-rouge">plan</code></strong>, <strong><code class="language-plaintext highlighter-rouge">spec</code></strong>, <strong><code class="language-plaintext highlighter-rouge">stage</code></strong>, <strong><code class="language-plaintext highlighter-rouge">work</code></strong>, <strong><code class="language-plaintext highlighter-rouge">e2e</code></strong>, <strong><code class="language-plaintext highlighter-rouge">set</code></strong>. Only one invocation that operates on a given directory (init, commit, stage, plan, work, spec, e2e) runs at a time for that directory; a second invocation for the same directory waits until the first exits. The workflow operations <strong>plan</strong>, <strong>spec</strong>, <strong>work</strong>, <strong>e2e</strong>, <strong>stage</strong>, and <strong>commit</strong> can be run in any order and combination in a single invocation: for example <code class="language-plaintext highlighter-rouge">bus dev plan spec work</code>, <code class="language-plaintext highlighter-rouge">bus dev plan work stage commit</code>, or <code class="language-plaintext highlighter-rouge">bus dev spec plan work stage commit plan work stage commit</code>. When you list two or more operations, they run one at a time in the order you give them and the run stops on first failure. <strong>init</strong> accepts an optional directory, then zero or more workflow operations from the set plan, spec, work, e2e (stage and commit are not accepted after init), executed in the order provided. The <strong><code class="language-plaintext highlighter-rouge">set</code></strong> subcommands do not participate in the per-directory lock.</p>

<p><code class="language-plaintext highlighter-rouge">bus dev init [DIR] [--lang go] [plan|spec|work|e2e ...]</code> — initialize module files in the current directory by default, or in <code class="language-plaintext highlighter-rouge">DIR</code> when provided; does not run plan/spec/work/e2e unless explicitly listed.<br>
<code class="language-plaintext highlighter-rouge">bus dev commit</code> — commit staged changes with high-quality messages (no remote, no history rewrite).<br>
<code class="language-plaintext highlighter-rouge">bus dev stage</code> — prepare the working tree for commit by having the agent ensure only intended files are staged: identify temporary files, e2e leftovers, and other files that should not be tracked, add them to <code class="language-plaintext highlighter-rouge">.gitignore</code> or remove them, then stage the rest; combinable with plan, spec, work, e2e, and commit so you can run full cycles in one invocation.<br>
<code class="language-plaintext highlighter-rouge">bus dev plan</code> — review SDD and docs against repository state, then refresh <code class="language-plaintext highlighter-rouge">PLAN.md</code> with prioritized unchecked undone work items only.<br>
<code class="language-plaintext highlighter-rouge">bus dev spec</code> — ensure the repository has a compact but detailed local spec in <a href="https://agents.md/">AGENTS.md</a> that reflects the latest BusDK specifications and describes how to implement this tool; creates AGENTS.md from online SDD and user documentation when missing.<br>
<code class="language-plaintext highlighter-rouge">bus dev work</code> — run the “do the work in this repo” agent workflow (code, tests, README).<br>
<code class="language-plaintext highlighter-rouge">bus dev e2e</code> — guided workflow to detect and scaffold missing end-to-end tests.<br>
<code class="language-plaintext highlighter-rouge">bus dev set agent &lt;cursor|codex|gemini|claude&gt;</code> — set the bus-dev persistent default agent (<code class="language-plaintext highlighter-rouge">bus-dev.agent</code>) via the bus-preferences Go library.<br>
<code class="language-plaintext highlighter-rouge">bus dev set model &lt;value&gt;</code> — set the bus-dev persistent default model (<code class="language-plaintext highlighter-rouge">bus-dev.model</code>).<br>
<code class="language-plaintext highlighter-rouge">bus dev set output-format &lt;ndjson|text&gt;</code> — set the bus-dev persistent default output format (<code class="language-plaintext highlighter-rouge">bus-dev.output_format</code>).<br>
<code class="language-plaintext highlighter-rouge">bus dev set timeout &lt;duration&gt;</code> — set the bus-dev persistent default timeout (<code class="language-plaintext highlighter-rouge">bus-dev.timeout</code>).<br>
<code class="language-plaintext highlighter-rouge">bus dev [plan|spec|work|e2e|stage|commit] ...</code> — run one or more of plan, spec, work, e2e, stage, and commit in the order you list them (e.g. <code class="language-plaintext highlighter-rouge">bus dev plan spec work</code> or <code class="language-plaintext highlighter-rouge">bus dev plan work stage commit</code>); if one fails, the run stops.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="description">Description</h3>

<p>Command names follow <a href="../cli/command-naming">CLI command naming</a>. <code class="language-plaintext highlighter-rouge">bus dev</code> is a developer-only companion that centralizes workflow logic that module repositories would otherwise duplicate in <code class="language-plaintext highlighter-rouge">scripts/</code>: module scaffolding, commit workflows, planning from documentation coverage gaps, agent-runner workflows, AGENTS.md creation and refinement (from online SDD and user docs when missing), and e2e test scaffolding. It provides a single entry point so behavior and prompts stay consistent and maintainable in one place, as described in the <a href="../sdd/bus-dev">module SDD</a>. Agent runtime execution (invoking Cursor CLI, Codex, Gemini CLI, or Claude CLI) is provided by the <a href="../sdd/bus-agent">bus-agent</a> library so that runtimes, detection, and diagnostics are consistent across BusDK; bus-dev supplies the workflow prompts and repository context. Bus-dev uses the same instruction model as bus-agent: <strong>AGENTS.md</strong> at the repository root is the canonical, vendor-neutral source of project instructions for commit, work, spec, and e2e; per-runtime adapters (Codex, Cursor, Gemini CLI, Claude Code) follow the contract defined in the <a href="../sdd/bus-agent">bus-agent SDD</a>, so the agent instruction contract is shared and testable across modules. The CLI accepts a single operation (e.g. <code class="language-plaintext highlighter-rouge">bus dev work</code>) or multiple operations in one invocation. The workflow operations — plan, spec, work, e2e, stage, and commit — can be combined in any order and any combination (including repeating one, e.g. <code class="language-plaintext highlighter-rouge">bus dev plan work stage commit plan work stage commit</code>); when multiple are given, they run one at a time in the order you list them and the run stops on first failure. Use <strong>stage</strong> when you want to prepare the working tree for commit in the same run as plan, work, or commit: the agent ensures temporary files, e2e test leftovers, and other unintended files are either added to <code class="language-plaintext highlighter-rouge">.gitignore</code> or removed before staging, so you do not accidentally commit them. Most subcommands operate on the <strong>current Git repository</strong> (source code and agent instructions in AGENTS.md); <code class="language-plaintext highlighter-rouge">bus dev init</code> is the exception — it can initialize files in place for the current directory, or in an explicitly provided target directory, without creating or touching a Git repository unless you do that yourself later. The tool does not operate on workspace accounting datasets. End users running <code class="language-plaintext highlighter-rouge">bus accounts</code>, <code class="language-plaintext highlighter-rouge">bus journal</code>, or <code class="language-plaintext highlighter-rouge">bus validate</code> do not need <code class="language-plaintext highlighter-rouge">bus dev</code>; it exists for contributors and automation working inside (or creating) a BusDK module repository.</p>

<p>All paths and the working directory are resolved relative to the current directory unless you set <code class="language-plaintext highlighter-rouge">-C</code> / <code class="language-plaintext highlighter-rouge">--chdir</code>. The tool discovers the repository root from the effective working directory and does not require a config file for repository-scoped commands. Subcommands that need a module name in repository scope (for example for e2e script naming) derive it deterministically from the repository: the module name is the base name of the repository root directory (the last path component of the absolute path to the repo root). For <code class="language-plaintext highlighter-rouge">init</code>, which can run outside a Git repository, the module name is derived from the base name of the init target directory.</p>

<p>Only one <code class="language-plaintext highlighter-rouge">bus dev</code> run that operates on a given directory (init, commit, stage, plan, work, spec, e2e) executes at a time for that directory. A second invocation that targets the same directory blocks until the first exits, then proceeds. This avoids concurrent edits to PLAN.md, AGENTS.md, and the staging area. The <code class="language-plaintext highlighter-rouge">set</code> subcommands do not take the lock and do not block. If the lock cannot be acquired (for example the directory is not writable), the command exits with code 1 and a clear message; see Exit status and errors.</p>

<p><strong>Safety.</strong> <code class="language-plaintext highlighter-rouge">bus dev</code> never runs remote Git operations (no push, pull, fetch, clone) and never rewrites history (no amend, rebase, squash). It may run the agent (for <strong>stage</strong>, <strong>plan</strong>, <strong>work</strong>, <strong>spec</strong>, <strong>e2e</strong>), local <code class="language-plaintext highlighter-rouge">git add</code> after the agent has cleaned the working tree (for <strong>stage</strong>), and local <code class="language-plaintext highlighter-rouge">git commit</code> only on already-staged content (commit never stages; use <strong>stage</strong> to stage). Bus-dev never edits any user configuration outside the project working directory; when it creates or modifies repo-local files for instruction or adapter support, changes are additive only (append-only Bus-owned blocks, no removal or rewrite of your content). The only exception is the legacy Cursor rule file at <code class="language-plaintext highlighter-rouge">.cursor/rules/&lt;module-name&gt;.mdc</code>, which may be replaced or migrated into AGENTS.md during <code class="language-plaintext highlighter-rouge">bus dev spec</code>. Diagnostics and progress go to stderr; stdout is reserved for deterministic results when a subcommand produces them. When run from a script or CI (headless), workflows remain non-interactive and do not perform prohibited actions such as network operations or modifying user-global agent configuration.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="commands">Commands</h3>

<p><strong><code class="language-plaintext highlighter-rouge">init [DIR] [--lang go] [plan|spec|work|e2e ...]</code></strong> — Initialize module root files without performing any Git operations. If <code class="language-plaintext highlighter-rouge">DIR</code> is omitted, initialization happens in the effective current working directory. If <code class="language-plaintext highlighter-rouge">DIR</code> is provided, initialization happens there (the directory is created if missing). When you run init, it ensures a single <a href="https://agents.md/">AGENTS.md</a> exists at the project root (the target directory) and ensures a root <code class="language-plaintext highlighter-rouge">Makefile</code> exists by writing a built-in sample Makefile when missing. Init is not required to create AGENTS.md: in an existing repository you can run <code class="language-plaintext highlighter-rouge">bus dev spec</code> and the tool creates AGENTS.md from the online SDD and module end-user documentation when the file is missing. The <code class="language-plaintext highlighter-rouge">--lang</code> flag defaults to <code class="language-plaintext highlighter-rouge">go</code> and controls which default AGENTS.md content init installs when you use init. By default this command only initializes files; it does <strong>not</strong> run <code class="language-plaintext highlighter-rouge">plan</code>, <code class="language-plaintext highlighter-rouge">spec</code>, <code class="language-plaintext highlighter-rouge">work</code>, or <code class="language-plaintext highlighter-rouge">e2e</code>. To run workflow operations as part of init, append them explicitly in any order; they run in the exact order you provide, for example <code class="language-plaintext highlighter-rouge">bus dev init plan spec work</code> or <code class="language-plaintext highlighter-rouge">bus dev init bus-accounts work plan e2e</code> (target directory). If any requested step fails, the command exits non-zero with a clear diagnostic. Use this when you want deterministic in-place initialization first, then optional AI workflow steps under explicit control.</p>

<p><strong><code class="language-plaintext highlighter-rouge">commit</code></strong> — Create one or more commits from the <strong>currently staged</strong> changes only. If there is nothing staged (and no submodules with staged changes to commit), the command does nothing and exits 0. The tool does not modify files, does not stage anything, and does not amend or rebase. If the repository has submodules, it commits inside submodules first (depth-first), then the superproject only if it has staged changes. If a submodule commit leaves an unstaged gitlink in the superproject, the tool reports that clearly and stops without staging it; you must stage the gitlink manually if desired. For each commit, the message must have a concise, imperative subject line; a body may follow, with traceability (issue IDs or URLs) when helpful. By default the tool commits exactly what is currently staged and does not alter the staging area. If a hook (e.g. pre-commit, commit-msg) fails, the tool reports the failure and exits non-zero; it does not retry.</p>

<p><strong><code class="language-plaintext highlighter-rouge">stage</code></strong> — Prepare the working tree for commit by ensuring only intended files are staged. The tool invokes the configured agent with an embedded prompt that instructs it to review the working tree, identify files that should not be tracked (for example temporary files, e2e test leftovers, or build artifacts), and either add them (or matching patterns) to <code class="language-plaintext highlighter-rouge">.gitignore</code> or remove them from the project. After the agent has finished, the tool stages all remaining changes at the repository root so that a subsequent <strong>commit</strong> has only the intended content. May be combined with <strong>plan</strong>, <strong>spec</strong>, <strong>work</strong>, <strong>e2e</strong>, and <strong>commit</strong> in any order (e.g. <code class="language-plaintext highlighter-rouge">bus dev plan work stage commit</code>). Does not commit, amend, or rebase, and does not perform any remote Git operations. If the repository has submodules, only the current repository’s working tree is in scope; see the <a href="../sdd/bus-dev">module SDD</a> for the normative rule.</p>

<p><strong><code class="language-plaintext highlighter-rouge">plan</code></strong> — Build or refresh <code class="language-plaintext highlighter-rouge">PLAN.md</code> at repository root as a compact prioritized checklist of undone work. May be combined with <strong>spec</strong>, <strong>work</strong>, and <strong>e2e</strong> in any order; operations run in the order you list them and stop on first failure. The command reviews the current repository, the <a href="../sdd">main SDD</a>, the current module SDD, the current module end-user docs, and other project SDD pages relevant to requirement coverage. It detects unimplemented features and other undone work and writes only <code class="language-plaintext highlighter-rouge">PLAN.md</code>. When <code class="language-plaintext highlighter-rouge">PLAN.md</code> already exists, the command re-validates existing items, removes items that are already done (including checked items), keeps items that are still undone, and adds newly detected missing work. This command is the one that prunes completed checked items from the plan. The file written by <code class="language-plaintext highlighter-rouge">bus dev plan</code> is a compact unchecked task list ordered by priority, with one unchecked item per undone work item and no implementation-level detail that should instead come from the SDD and related docs.</p>

<p><strong><code class="language-plaintext highlighter-rouge">work</code></strong> — Run the canonical “do the work in this repo now” workflow. May be combined with <strong>plan</strong>, <strong>spec</strong>, and <strong>e2e</strong> in any order (e.g. <code class="language-plaintext highlighter-rouge">bus dev plan work</code> or <code class="language-plaintext highlighter-rouge">bus dev work plan spec e2e</code>); operations run in the order you list them and stop on first failure. At the start of each agent step (plan, work, spec, e2e, stage), the tool prints to stderr which internal agent runtime and which model are in use for that step. The tool invokes the configured external agent runtime with an embedded prompt that tells it to operate only inside the current module repository: make concrete code changes, add or update tests, run the Makefile checks, and update README before finishing. The agent is allowed to read the repository’s AGENTS.md and design docs as the authoritative specs. When <code class="language-plaintext highlighter-rouge">PLAN.md</code> exists at repository root, the workflow reads it first and prioritizes unchecked items before proposing additional work. As work items are completed, <code class="language-plaintext highlighter-rouge">bus dev work</code> checks them off in <code class="language-plaintext highlighter-rouge">PLAN.md</code>. It does not remove already checked items; checked-item pruning is handled by <code class="language-plaintext highlighter-rouge">bus dev plan</code>. When the selected runtime is Gemini CLI, the agent may also use repository-local Gemini context (e.g. repo-root <code class="language-plaintext highlighter-rouge">GEMINI.md</code>, <code class="language-plaintext highlighter-rouge">.gemini/settings.json</code>, <code class="language-plaintext highlighter-rouge">.geminiignore</code>); Bus Dev never modifies user-global Gemini configuration or memory. Which agent runtime is used is determined by the agent selection configuration (see below). This subcommand does not perform any Git remote operations.</p>

<p><strong><code class="language-plaintext highlighter-rouge">spec</code></strong> — Ensure the repository has a compact but detailed local spec in <a href="https://agents.md/">AGENTS.md</a> that reflects the latest BusDK specifications and describes how to implement this tool. May be combined with <strong>plan</strong>, <strong>work</strong>, and <strong>e2e</strong> in any order; operations run in the order you list them and stop on first failure. The file is always <code class="language-plaintext highlighter-rouge">AGENTS.md</code> at the repository root. When AGENTS.md does not exist, the command creates it from the online SDD and module end-user documentation in the same run. If a Cursor rule file exists at <code class="language-plaintext highlighter-rouge">.cursor/rules/&lt;module-name&gt;.mdc</code> (where the module name is the base name of the repo, e.g. <code class="language-plaintext highlighter-rouge">bus-accounts</code>), its content is refactored into AGENTS.md and that file is then removed. No source code, tests, or README are changed. The refinement is driven by an embedded prompt inside the binary; the agent may read BusDK docs and the AGENTS.md format to align the file. When Gemini CLI is selected, repository-local Gemini context is used in parallel; Bus Dev does not write to user-global Gemini config or memory.</p>

<p><strong><code class="language-plaintext highlighter-rouge">e2e</code></strong> — Guided workflow to detect missing end-to-end tests for the current module and scaffold them in a hermetic way, consistent with BusDK testing conventions and the module’s <a href="../sdd/bus-dev">SDD</a> and end-user documentation. May be combined with <strong>plan</strong>, <strong>spec</strong>, and <strong>work</strong> in any order; operations run in the order you list them and stop on first failure. E2E tests are Bash scripts under <code class="language-plaintext highlighter-rouge">tests/</code> named <code class="language-plaintext highlighter-rouge">e2e_bus_&lt;name&gt;.sh</code>, where <code class="language-plaintext highlighter-rouge">&lt;name&gt;</code> is the module name with the <code class="language-plaintext highlighter-rouge">bus-</code> prefix stripped (for example <code class="language-plaintext highlighter-rouge">bus-accounts</code> → <code class="language-plaintext highlighter-rouge">tests/e2e_bus_accounts.sh</code>). The tool uses the module’s SDD and end-user docs to determine which tests are needed and produces scaffolds that cover the behavior described there. When <code class="language-plaintext highlighter-rouge">PLAN.md</code> exists at repository root, the workflow reads it first, treats checked items as completed-feature coverage obligations, verifies each checked item is fully covered by e2e tests, and prioritizes unchecked test-related items. It also continues to search SDD and end-user docs for other untested behavior exactly as it does without <code class="language-plaintext highlighter-rouge">PLAN.md</code>. This subcommand does not remove already checked plan items; checked-item pruning is handled by <code class="language-plaintext highlighter-rouge">bus dev plan</code>. The command does not perform remote Git operations or modify workspace accounting datasets.</p>

<p><strong><code class="language-plaintext highlighter-rouge">set</code></strong> — Set a persistent preference via the <a href="./bus-preferences">bus-preferences</a> Go library (no shell-out to <code class="language-plaintext highlighter-rouge">bus preferences</code>). Bus-dev provides a dedicated subcommand for each key that affects agent use:</p>

<p><strong><code class="language-plaintext highlighter-rouge">set agent &lt;runtime&gt;</code></strong> — Set the bus-dev persistent default agent (<code class="language-plaintext highlighter-rouge">bus-dev.agent</code>) via the bus-preferences Go library. Only the <code class="language-plaintext highlighter-rouge">bus-dev</code> namespace is written; no other namespace is modified. <code class="language-plaintext highlighter-rouge">&lt;runtime&gt;</code> must be one of <code class="language-plaintext highlighter-rouge">cursor</code>, <code class="language-plaintext highlighter-rouge">codex</code>, <code class="language-plaintext highlighter-rouge">gemini</code>, or <code class="language-plaintext highlighter-rouge">claude</code>. Invalid runtime yields exit 2.</p>

<p><strong><code class="language-plaintext highlighter-rouge">set model &lt;value&gt;</code></strong> — Set the bus-dev persistent default model (<code class="language-plaintext highlighter-rouge">bus-dev.model</code>) via the bus-preferences Go library. Only the <code class="language-plaintext highlighter-rouge">bus-dev</code> namespace is written. Invalid value yields exit 2.</p>

<p><strong><code class="language-plaintext highlighter-rouge">set output-format &lt;ndjson|text&gt;</code></strong> — Set the bus-dev persistent default output format (<code class="language-plaintext highlighter-rouge">bus-dev.output_format</code>) via the bus-preferences Go library. Valid values: <code class="language-plaintext highlighter-rouge">ndjson</code> (raw structured output), <code class="language-plaintext highlighter-rouge">text</code> (human-readable). Only the <code class="language-plaintext highlighter-rouge">bus-dev</code> namespace is written. Invalid value yields exit 2.</p>

<p><strong><code class="language-plaintext highlighter-rouge">set timeout &lt;duration&gt;</code></strong> — Set the bus-dev persistent default timeout (<code class="language-plaintext highlighter-rouge">bus-dev.timeout</code>) via the bus-preferences Go library (e.g. <code class="language-plaintext highlighter-rouge">60m</code>). Only the <code class="language-plaintext highlighter-rouge">bus-dev</code> namespace is written. Invalid value yields exit 2.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="global-flags">Global flags</h3>

<p>These flags apply to all subcommands. The common subset matches the <a href="../cli/global-flags">standard global flags</a>; <code class="language-plaintext highlighter-rouge">bus dev</code> adds <code class="language-plaintext highlighter-rouge">--agent</code> for runtime selection. They can appear in any order before the subcommand. A lone <code class="language-plaintext highlighter-rouge">--</code> ends flag parsing; any following tokens are passed to the subcommand.</p>

<ul>
  <li>
<strong><code class="language-plaintext highlighter-rouge">-h</code></strong>, <strong><code class="language-plaintext highlighter-rouge">--help</code></strong> — Print help to stdout and exit 0. Other flags and arguments are ignored when help is requested.</li>
  <li>
<strong><code class="language-plaintext highlighter-rouge">-V</code></strong>, <strong><code class="language-plaintext highlighter-rouge">--version</code></strong> — Print the tool name and version to stdout and exit 0.</li>
  <li>
<strong><code class="language-plaintext highlighter-rouge">-v</code></strong>, <strong><code class="language-plaintext highlighter-rouge">--verbose</code></strong> — Send verbose progress and diagnostics to stderr. You can repeat the flag (e.g. <code class="language-plaintext highlighter-rouge">-vv</code>) to increase verbosity. Verbose output does not change what is written to stdout.</li>
  <li>
<strong><code class="language-plaintext highlighter-rouge">-q</code></strong>, <strong><code class="language-plaintext highlighter-rouge">--quiet</code></strong> — Suppress normal command result output. When quiet is set, only errors go to stderr. Exit codes are unchanged. You cannot combine <code class="language-plaintext highlighter-rouge">--quiet</code> with <code class="language-plaintext highlighter-rouge">--verbose</code>; doing so is invalid usage (exit 2).</li>
  <li>
<strong><code class="language-plaintext highlighter-rouge">-C &lt;dir&gt;</code></strong>, <strong><code class="language-plaintext highlighter-rouge">--chdir &lt;dir&gt;</code></strong> — Use <code class="language-plaintext highlighter-rouge">&lt;dir&gt;</code> as the effective working directory. The repository root and all paths are resolved from this directory. If it does not exist or is not accessible, the command exits with code 1. If the effective directory is not inside a Git repository, subcommands that require a repo exit with code 2 and a clear message.</li>
  <li>
<strong><code class="language-plaintext highlighter-rouge">-o &lt;file&gt;</code></strong>, <strong><code class="language-plaintext highlighter-rouge">--output &lt;file&gt;</code></strong> — Redirect normal command output to <code class="language-plaintext highlighter-rouge">&lt;file&gt;</code> instead of stdout. The file is created or truncated. Errors and diagnostics still go to stderr. If both <code class="language-plaintext highlighter-rouge">--output</code> and <code class="language-plaintext highlighter-rouge">--quiet</code> are used, quiet wins: no output is written to the file.</li>
  <li>
<strong><code class="language-plaintext highlighter-rouge">--color &lt;mode&gt;</code></strong> — Control colored output on stderr. <code class="language-plaintext highlighter-rouge">&lt;mode&gt;</code> must be <code class="language-plaintext highlighter-rouge">auto</code>, <code class="language-plaintext highlighter-rouge">always</code>, or <code class="language-plaintext highlighter-rouge">never</code>. Invalid value is usage error (exit 2).</li>
  <li>
<strong><code class="language-plaintext highlighter-rouge">--no-color</code></strong> — Same as <code class="language-plaintext highlighter-rouge">--color=never</code>.</li>
  <li>
<strong><code class="language-plaintext highlighter-rouge">--agent &lt;runtime&gt;</code></strong> — Select the agent runtime for this invocation only. <code class="language-plaintext highlighter-rouge">&lt;runtime&gt;</code> must be one of <code class="language-plaintext highlighter-rouge">cursor</code>, <code class="language-plaintext highlighter-rouge">codex</code>, <code class="language-plaintext highlighter-rouge">gemini</code>, or <code class="language-plaintext highlighter-rouge">claude</code>. Invalid value is usage error (exit 2). This overrides the default set by <code class="language-plaintext highlighter-rouge">BUS_DEV_AGENT</code>, <code class="language-plaintext highlighter-rouge">BUS_AGENT</code>, and any persistent preferences (see Agent runtime selection below).</li>
</ul>

<p>Command results are written to stdout when a subcommand produces them. Diagnostics, progress, and human-readable agent output are written to stderr.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="agent-runtime-selection">Agent runtime selection</h3>

<p>Subcommands that invoke an external agent (<code class="language-plaintext highlighter-rouge">plan</code>, <code class="language-plaintext highlighter-rouge">work</code>, <code class="language-plaintext highlighter-rouge">spec</code>, and <code class="language-plaintext highlighter-rouge">e2e</code>, including when these are requested after <code class="language-plaintext highlighter-rouge">init</code>) use the <a href="../sdd/bus-agent">bus-agent</a> library and one of its supported runtimes: <strong>Cursor CLI</strong>, <strong>Codex</strong>, <strong>Gemini CLI</strong>, and <strong>Claude CLI</strong>. At the start of each such step, the tool prints to stderr which internal agent and which model are in use so that logs and scripts can see the active runtime and model.</p>

<p>The active runtime is chosen in this order: (1) <strong><code class="language-plaintext highlighter-rouge">--agent &lt;runtime&gt;</code></strong> for that invocation; (2) <strong><code class="language-plaintext highlighter-rouge">BUS_DEV_AGENT</code></strong> (bus-dev-only session default; when set, used for every <code class="language-plaintext highlighter-rouge">bus dev</code> command in that session until unset or overridden); (3) <strong><code class="language-plaintext highlighter-rouge">BUS_AGENT</code></strong> (shared session default, used when <code class="language-plaintext highlighter-rouge">BUS_DEV_AGENT</code> is not set); (4) <strong>bus-dev persistent preference</strong> (e.g. <code class="language-plaintext highlighter-rouge">bus-dev.agent</code> via <a href="./bus-preferences">bus-preferences</a>, affects only bus-dev); (5) <strong>bus-agent persistent preference</strong> (<code class="language-plaintext highlighter-rouge">bus-agent.runtime</code>); (6) <strong>first available</strong> runtime in the effective order (alphabetic by runtime ID by default). Set bus-dev’s default with <code class="language-plaintext highlighter-rouge">bus preferences set bus-dev.agent &lt;runtime&gt;</code> and the shared default with <code class="language-plaintext highlighter-rouge">bus preferences set bus-agent.runtime &lt;runtime&gt;</code>. At any step, if the configured runtime is <strong>disabled</strong> by user configuration, the tool prints a warning to stderr and continues with the next source. You can configure agent order and enable/disable; see the <a href="../sdd/bus-agent">bus-agent</a> SDD and <a href="./bus-agent">bus-agent module docs</a>.</p>

<p>Invalid runtime names (e.g. <code class="language-plaintext highlighter-rouge">--agent unknown</code> or an invalid value in <code class="language-plaintext highlighter-rouge">BUS_DEV_AGENT</code> or <code class="language-plaintext highlighter-rouge">BUS_AGENT</code>) produce a clear usage error and exit 2. If the user has selected an agent (via flag or <code class="language-plaintext highlighter-rouge">BUS_DEV_AGENT</code>) and that agent’s CLI is not installed or not in PATH, the tool reports that on stderr, directs you to the canonical installation URL for that runtime, and exits with code 1. When no runtime is selected and no agent is available (none in PATH or all disabled/restricted), the tool exits with a clear diagnostic and directs you to install or enable at least one supported agent, with pointers to the canonical installation URLs for each runtime. Model, output format, and timeout follow the same resolution logic as agent (see Preference settings below): bus-dev session env (<code class="language-plaintext highlighter-rouge">BUS_DEV_MODEL</code>, <code class="language-plaintext highlighter-rouge">BUS_DEV_TIMEOUT</code>, <code class="language-plaintext highlighter-rouge">BUS_DEV_OUTPUT_FORMAT</code>), then bus-dev persistent preferences (<code class="language-plaintext highlighter-rouge">bus-dev.model</code>, <code class="language-plaintext highlighter-rouge">bus-dev.timeout</code>, <code class="language-plaintext highlighter-rouge">bus-dev.output_format</code>), then bus-agent preferences as fallback, then bus-agent defaults (e.g. model <code class="language-plaintext highlighter-rouge">auto</code>, output format <code class="language-plaintext highlighter-rouge">text</code>).</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="preference-settings-bus-preferences">Preference settings (bus-preferences)</h3>

<p>Preferences that affect <code class="language-plaintext highlighter-rouge">bus dev</code> are stored via the <a href="./bus-preferences">bus-preferences</a> Go library. <strong>Bus-dev only ever writes to the <code class="language-plaintext highlighter-rouge">bus-dev</code> namespace.</strong> When you run <code class="language-plaintext highlighter-rouge">bus dev set agent</code>, <code class="language-plaintext highlighter-rouge">bus dev set model</code>, <code class="language-plaintext highlighter-rouge">bus dev set output-format</code>, or <code class="language-plaintext highlighter-rouge">bus dev set timeout</code>, the tool writes only the corresponding <code class="language-plaintext highlighter-rouge">bus-dev.*</code> key (e.g. <code class="language-plaintext highlighter-rouge">bus-dev.agent</code>, <code class="language-plaintext highlighter-rouge">bus-dev.model</code>, <code class="language-plaintext highlighter-rouge">bus-dev.output_format</code>, <code class="language-plaintext highlighter-rouge">bus-dev.timeout</code>) and never modifies <code class="language-plaintext highlighter-rouge">bus-agent.*</code> or any other namespace. When bus-dev invokes the agent (plan, work, spec, e2e), it resolves each option in the same order: per-command override (e.g. <code class="language-plaintext highlighter-rouge">--agent</code>) if present, then bus-dev session environment (<code class="language-plaintext highlighter-rouge">BUS_DEV_AGENT</code>, <code class="language-plaintext highlighter-rouge">BUS_DEV_MODEL</code>, <code class="language-plaintext highlighter-rouge">BUS_DEV_TIMEOUT</code>, <code class="language-plaintext highlighter-rouge">BUS_DEV_OUTPUT_FORMAT</code>), then bus-dev persistent preferences (<code class="language-plaintext highlighter-rouge">bus-dev.agent</code>, <code class="language-plaintext highlighter-rouge">bus-dev.model</code>, <code class="language-plaintext highlighter-rouge">bus-dev.timeout</code>, <code class="language-plaintext highlighter-rouge">bus-dev.output_format</code>), then bus-agent persistent preferences as fallback (<code class="language-plaintext highlighter-rouge">bus-agent.runtime</code>, <code class="language-plaintext highlighter-rouge">bus-agent.model</code>, <code class="language-plaintext highlighter-rouge">bus-agent.output_format</code>, <code class="language-plaintext highlighter-rouge">bus-agent.timeout</code>), then bus-agent defaults. Set any bus-dev default with <strong><code class="language-plaintext highlighter-rouge">bus dev set &lt;key&gt; &lt;value&gt;</code></strong> (e.g. <code class="language-plaintext highlighter-rouge">bus dev set agent gemini</code>, <code class="language-plaintext highlighter-rouge">bus dev set model auto</code>, <code class="language-plaintext highlighter-rouge">bus dev set output-format text</code>, <code class="language-plaintext highlighter-rouge">bus dev set timeout 60m</code>) or with <code class="language-plaintext highlighter-rouge">bus preferences set bus-dev.&lt;key&gt; &lt;value&gt;</code>. Inspect with <code class="language-plaintext highlighter-rouge">bus preferences get &lt;key&gt;</code>. The bus-dev CLI uses the bus-preferences library directly and does not shell out to <code class="language-plaintext highlighter-rouge">bus preferences</code>.</p>

<table>
  <thead>
    <tr>
      <th>Key</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">bus-dev.agent</code></td>
      <td>Bus-dev default agent runtime. Valid values: <strong><code class="language-plaintext highlighter-rouge">cursor</code></strong>, <strong><code class="language-plaintext highlighter-rouge">codex</code></strong>, <strong><code class="language-plaintext highlighter-rouge">gemini</code></strong>, <strong><code class="language-plaintext highlighter-rouge">claude</code></strong>. Resolution order: <code class="language-plaintext highlighter-rouge">--agent</code> → <code class="language-plaintext highlighter-rouge">BUS_DEV_AGENT</code> → <code class="language-plaintext highlighter-rouge">BUS_AGENT</code> → <code class="language-plaintext highlighter-rouge">bus-dev.agent</code> → <code class="language-plaintext highlighter-rouge">bus-agent.runtime</code> → first available. Set with <code class="language-plaintext highlighter-rouge">bus dev set agent &lt;runtime&gt;</code>. For the shared default when not using bus-dev, set <code class="language-plaintext highlighter-rouge">bus-agent.runtime</code> via <code class="language-plaintext highlighter-rouge">bus agent set runtime &lt;runtime&gt;</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">bus-dev.model</code></td>
      <td>Bus-dev default model (e.g. for Cursor). Resolution order: per-command override (if any) → <code class="language-plaintext highlighter-rouge">BUS_DEV_MODEL</code> → <code class="language-plaintext highlighter-rouge">bus-dev.model</code> → <code class="language-plaintext highlighter-rouge">bus-agent.model</code> → bus-agent default (<code class="language-plaintext highlighter-rouge">auto</code>). Set with <code class="language-plaintext highlighter-rouge">bus dev set model &lt;value&gt;</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">bus-dev.output_format</code></td>
      <td>Bus-dev default output format. Valid values: <strong><code class="language-plaintext highlighter-rouge">ndjson</code></strong> (raw structured output), <strong><code class="language-plaintext highlighter-rouge">text</code></strong> (human-readable). Resolution order: per-command override (if any) → <code class="language-plaintext highlighter-rouge">BUS_DEV_OUTPUT_FORMAT</code> → <code class="language-plaintext highlighter-rouge">bus-dev.output_format</code> → <code class="language-plaintext highlighter-rouge">bus-agent.output_format</code> → bus-agent default (<code class="language-plaintext highlighter-rouge">text</code>). Set with <code class="language-plaintext highlighter-rouge">bus dev set output-format &lt;ndjson|text&gt;</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">bus-dev.timeout</code></td>
      <td>Bus-dev default run timeout as a duration string (e.g. <code class="language-plaintext highlighter-rouge">60m</code>). Resolution order: per-command override (if any) → <code class="language-plaintext highlighter-rouge">BUS_DEV_TIMEOUT</code> → <code class="language-plaintext highlighter-rouge">bus-dev.timeout</code> → <code class="language-plaintext highlighter-rouge">bus-agent.timeout</code> → bus-agent default. Set with <code class="language-plaintext highlighter-rouge">bus dev set timeout &lt;duration&gt;</code>.</td>
    </tr>
  </tbody>
</table>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="example-building-a-module-from-scratch-with-ai">Example: building a module from scratch with AI</h3>

<p>BusDK specifications are openly readable. You can have an AI-assisted workflow build a bus module from scratch, then optionally initialize Git and commit. Prerequisites: install one of the supported agent runtimes (Cursor CLI, Codex, Gemini CLI, or Claude CLI), BusDK (at least v0.0.15), and Go.</p>

<p><strong>Option: initialize only, then run workflows explicitly.</strong> From the module root you want to initialize, run <code class="language-plaintext highlighter-rouge">bus dev init [--lang go]</code>. Or from a parent directory, run <code class="language-plaintext highlighter-rouge">bus dev init bus-accounts [--lang go]</code>. The tool initializes a root <a href="https://agents.md/">AGENTS.md</a> and a root <code class="language-plaintext highlighter-rouge">Makefile</code> (from a built-in sample when missing). It does not run any Git commands and does not run <code class="language-plaintext highlighter-rouge">spec</code>, <code class="language-plaintext highlighter-rouge">work</code>, or <code class="language-plaintext highlighter-rouge">e2e</code> unless you ask for them. After initialization, run <code class="language-plaintext highlighter-rouge">bus dev plan</code> to refresh <code class="language-plaintext highlighter-rouge">PLAN.md</code>, then run <code class="language-plaintext highlighter-rouge">bus dev spec work e2e</code> in that module directory when you want the AI workflow sequence.</p>

<p><strong>Option: initialize and run ordered workflows in one command.</strong> If you want initialization plus workflow operations in one invocation, append the operations after init. <code class="language-plaintext highlighter-rouge">bus dev init spec work e2e</code> initializes the current directory and runs the three operations in that exact order. <code class="language-plaintext highlighter-rouge">bus dev init bus-accounts spec work e2e</code> does the same in <code class="language-plaintext highlighter-rouge">bus-accounts</code>. If one operation fails, later operations are not run.</p>

<p><strong>Option: manual steps.</strong> If you prefer to create everything yourself, create the module directory and a root <code class="language-plaintext highlighter-rouge">Makefile</code> (and optionally a root <a href="https://agents.md/">AGENTS.md</a> if you want a starting point), then run <code class="language-plaintext highlighter-rouge">bus dev spec work e2e</code> (or the three operations in separate invocations), then initialize Git and commit as desired. You do not need to create <code class="language-plaintext highlighter-rouge">AGENTS.md</code> first: <code class="language-plaintext highlighter-rouge">bus dev spec</code> creates it from the online SDD and module end-user documentation when it is missing. The <code class="language-plaintext highlighter-rouge">--lang</code> flag on <code class="language-plaintext highlighter-rouge">init</code> (default <code class="language-plaintext highlighter-rouge">go</code>) controls which default AGENTS.md content is installed when you use init instead of creating files manually.</p>

<p><strong>Option: full cycle in one invocation.</strong> To run plan, work, stage, and commit repeatedly without leaving the tool, combine operations: <code class="language-plaintext highlighter-rouge">bus dev plan work stage commit plan work stage commit</code>. Each <strong>stage</strong> invokes the agent to clean the working tree (update <code class="language-plaintext highlighter-rouge">.gitignore</code> or remove unintended files), then stages the remaining changes so the following <strong>commit</strong> has only intended content.</p>

<p>Because the specs are public and machine-readable, this flow lets you regenerate or rewrite any bus module from scratch with AI, without depending on pre-packaged source. If you prefer not to build from specs yourself, we offer tested and verified bus module source code for a fee. We also offer compiled binaries for free.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="files">Files</h3>

<p><code class="language-plaintext highlighter-rouge">bus dev</code> does not read or write workspace accounting datasets (CSV, schemas, datapackage.json). It operates on the Git repository (metadata and index) and, when running the agent, on the repository working tree (source files, repository-root <strong>AGENTS.md</strong> as the canonical project instruction source). To ensure only one run per directory at a time, the tool uses a lock file (e.g. <code class="language-plaintext highlighter-rouge">.bus-dev.lock</code>) in the effective operation directory; the lock is released when the command exits. The documentation base URL used in prompts and diagnostics is configurable via <code class="language-plaintext highlighter-rouge">BUS_DEV_DOCS_BASE_URL</code> (default <code class="language-plaintext highlighter-rouge">https://docs.busdk.com</code>). <code class="language-plaintext highlighter-rouge">bus dev spec</code> creates or updates repository-root <code class="language-plaintext highlighter-rouge">AGENTS.md</code>, creating it from the online SDD and module end-user documentation when missing so the result is a compact local implementation spec; if a Cursor rule file exists at <code class="language-plaintext highlighter-rouge">.cursor/rules/&lt;module-name&gt;.mdc</code> (module name = base name of the repo), its content is merged into <code class="language-plaintext highlighter-rouge">AGENTS.md</code> and that file is then removed — this is the only case where bus-dev may remove or replace existing repo content for instruction standardization. The tool also uses repository-root <code class="language-plaintext highlighter-rouge">PLAN.md</code> for planning continuity: <code class="language-plaintext highlighter-rouge">bus dev work</code> checks off completed plan items, <code class="language-plaintext highlighter-rouge">bus dev e2e</code> validates that checked items are fully covered by e2e tests and still searches docs for other missing tests, and neither <code class="language-plaintext highlighter-rouge">work</code> nor <code class="language-plaintext highlighter-rouge">e2e</code> removes checked items. <code class="language-plaintext highlighter-rouge">bus dev plan</code> is the command that re-validates the plan and prunes completed checked items while adding newly detected missing work. When Gemini CLI is selected, the tool uses only repository-local Gemini files (e.g. repo-root <code class="language-plaintext highlighter-rouge">GEMINI.md</code>, <code class="language-plaintext highlighter-rouge">.gemini/settings.json</code>, <code class="language-plaintext highlighter-rouge">.geminiignore</code>) and never modifies user-global Gemini configuration or memory. How each runtime (Codex, Cursor, Gemini CLI, Claude Code) loads AGENTS.md is defined by the shared instruction contract in the <a href="../sdd/bus-agent">bus-agent SDD</a>. No bus-dev-specific config file is required; configuration is via flags and environment only.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="exit-status-and-errors">Exit status and errors</h3>

<ul>
  <li>
<strong>0</strong> — Success. For <code class="language-plaintext highlighter-rouge">bus dev commit</code>, “nothing to commit” is success.</li>
  <li>
<strong>1</strong> — Execution failure: Git command failed, hook failed, agent failed or timed out, selected agent runtime not found or not executable, no agent enabled when the automatic default would apply, or working-directory lock could not be acquired (e.g. directory not writable).</li>
  <li>
<strong>2</strong> — Invalid usage: unknown subcommand, invalid flag (including invalid <code class="language-plaintext highlighter-rouge">--agent</code> or <code class="language-plaintext highlighter-rouge">set agent</code> runtime name), or precondition not met (e.g. not in a Git repository for commands that require one, or init target path is not a directory).</li>
</ul>

<p>Error messages are always on stderr. If you are not in a Git repository when a subcommand requires one, the tool exits with code 2 and a clear message. If the selected agent runtime is missing or cannot be executed, or if no agent is enabled when the automatic default would apply, the tool exits with code 1 and directs you to the canonical installation URLs for the supported runtimes. If the working-directory lock cannot be acquired (e.g. the directory is not writable or the lock file cannot be created), the tool exits with code 1 and reports that the lock could not be acquired; check directory permissions or whether another <code class="language-plaintext highlighter-rouge">bus dev</code> process is running in that directory.</p>

</div></section><section class="busdk-chapter busdk-chapter--level-3"><div class="busdk-chapter-section-inner busdk-content-inner">
<h3 id="development-state">Development state</h3>

<p><strong>Value:</strong> Developer tooling to scaffold and run standardized workflows (commit, work, spec, e2e, set) in BusDK module repos so contributors get a consistent Makefile, rules, and prompts.</p>

<p><strong>Use cases:</strong> <a href="../implementation/development-status#developer-module-workflow">Developer module workflow</a>.</p>

<p><strong>Completeness:</strong> 60% (Stable for one use case) — commit, work, spec, e2e, set and init scaffold verified by e2e; global flags and error paths test-backed.</p>

<p><strong>Use case readiness:</strong> Developer module workflow: 60% — init scaffold, set, and global flags verified; per-directory lock and AGENTS.md assert would complete.</p>

<p><strong>Current:</strong> E2e script <code class="language-plaintext highlighter-rouge">tests/e2e_bus_dev.sh</code> proves help, version, subcommand help, terminator, invalid quiet+verbose and color, missing chdir, and init creating Makefile, <code class="language-plaintext highlighter-rouge">.cursor/rules</code>, and stubs in the target directory. Unit tests in <code class="language-plaintext highlighter-rouge">run/run_test.go</code>, <code class="language-plaintext highlighter-rouge">internal/init/scaffold_test.go</code>, and related cover run, resolve, scaffold, prompts, and set.</p>

<p><strong>Planned next:</strong> Per-directory lock; remove <code class="language-plaintext highlighter-rouge">-f</code>/<code class="language-plaintext highlighter-rouge">--format</code>; e2e assert AGENTS.md at target root; README exit-codes and prompt names.</p>

<p><strong>Blockers:</strong> None known.</p>

<p><strong>Depends on:</strong> None.</p>

<p><strong>Used by:</strong> Developers in module repositories; no other bus module invokes it.</p>

<p>See <a href="../implementation/development-status">Development status</a>.</p>

<hr>

<!-- busdk-docs-nav start -->
</div></section>
</div></section><div class="busdk-prev-next-bar"><div class="busdk-content-inner"><p class="busdk-prev-next">
  <span class="busdk-prev-next-item busdk-prev">← <a href="./bus-data">bus-data</a></span>
  <span class="busdk-prev-next-item busdk-index"><a href="./index">Module CLI reference</a></span>
  <span class="busdk-prev-next-item busdk-next"><a href="./bus-agent">bus-agent</a> →</span>
</p></div></div>
<!-- busdk-docs-nav end -->

<div class="busdk-meta-block busdk-content-inner"><div class="busdk-meta-section">
<h3 id="sources">Sources</h3>

<ul>
  <li><a href="https://busdk.com/">BusDK — installation and overview</a></li>
  <li><a href="../sdd/bus-agent">Module SDD: bus-agent</a></li>
  <li><a href="../sdd/bus-preferences">Module SDD: bus-preferences</a></li>
  <li><a href="../sdd/bus-dev">Module SDD: bus-dev</a></li>
  <li><a href="./bus-preferences">bus-preferences CLI reference</a></li>
  <li><a href="./bus-config">bus-config CLI reference</a></li>
  <li><a href="../cli/error-handling-dry-run-diagnostics">CLI: Error handling, dry-run, and diagnostics</a></li>
  <li><a href="../implementation/module-repository-structure">Implementation: Module repository structure and dependency rules</a></li>
  <li><a href="https://geminicli.com/">Gemini CLI — install</a></li>
  <li><a href="https://cursor.com/docs/cli/overview">Cursor CLI — overview and install</a></li>
  <li><a href="https://github.com/anthropics/claude-code?tab=readme-ov-file#get-started">Claude Code — get started / install</a></li>
  <li><a href="https://developers.openai.com/codex/cli/">Codex CLI — install</a></li>
  <li><a href="https://agents.md/">AGENTS.md — open format for guiding coding agents</a></li>
</ul>
</div></div>
          </div>
        </main>
      </div>

      
      <footer class="busdk-footer" role="contentinfo">
        <div class="busdk-footer-inner">
          <span class="busdk-footer-edit">This site is open source. <a href="https://github.com/busdk/docs/edit/gh-pages/modules/bus-dev.md">Improve this page</a>.</span>
          <span class="busdk-footer-copyright">&copy; 2026 <a href="https://hg.fi">Heusala Group Ltd</a></span>
        </div>
      </footer>
      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>

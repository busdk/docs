<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en-US" }}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

{% seo %}
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}{% if site.github.build_revision %}?v={{ site.github.build_revision }}{% endif %}">
    {% include head-custom.html %}
  </head>
  <body class="busdk-docs-page">
    <div class="busdk-docs">
      <header class="busdk-site-header">
        <div class="busdk-site-header-inner">
          <a class="busdk-site-header-logo" href="{{ "/" | relative_url }}">{{ site.title }}</a>
        </div>
      </header>

      <div class="busdk-docs-body">
        {% unless page.permalink == "/" or page.url == "/" or page.permalink == "/404.html" or page.title == "Page not found" %}
        {% include sidebar.html %}
        {% endunless %}

        <main class="busdk-main {% if page.permalink == '/' or page.url == '/' %}busdk-main--home{% else %}busdk-main--with-sidebar{% endif %}">
          <div class="busdk-main-inner markdown-body">
            {% if page.permalink == "/404.html" or page.title == "Page not found" %}
            <header class="busdk-page-header">
              <div class="busdk-content-inner">
                <h1>{{ page.title }}</h1>
              </div>
            </header>
            {% elsif page.permalink != "/" and page.url != "/" %}
            <header class="busdk-page-header">
              <div class="busdk-content-inner">
                <h1>{{ page.title }}</h1>
              </div>
            </header>
            {% endif %}

            {% if page.layout == "home" %}
            {{ content }}
            {% else %}
            {{ content | wrap_busdk_chapters }}
            {% endif %}
          </div>
        </main>
      </div>

      {% if site.github.private != true and site.github.license and page.permalink != "/404.html" %}
      <footer class="busdk-footer" role="contentinfo">
        <div class="busdk-footer-inner">
          <span class="busdk-footer-edit">{% github_edit_link "Improve this page" %}</span>
          <span class="busdk-footer-links"><a href="https://busdk.com/">BusDK</a> · <a href="https://github.com/busdk/busdk">GitHub</a> · <a href="https://github.com/busdk/busdk/releases">Releases</a> · <a href="https://github.com/busdk/busdk/issues">Issues</a></span>
          <span class="busdk-footer-copyright">&copy; 2026 <a href="https://hg.fi">Heusala Group Ltd</a></span>
        </div>
      </footer>
      {% endif %}
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    {% unless page.permalink == "/" or page.url == "/" or page.permalink == "/404.html" or page.title == "Page not found" %}
    <script>
(function () {
  var sidebar = document.querySelector('.busdk-sidebar');
  if (!sidebar) return;

  var pathname = window.location.pathname.replace(/\/$/, '') || '/';

  function norm(href) {
    if (!href) return { path: '', hash: '' };
    var i = href.indexOf('#');
    if (i === -1) return { path: href.replace(/\/$/, '') || '/', hash: '' };
    return { path: href.slice(0, i).replace(/\/$/, '') || '/', hash: href.slice(i + 1) };
  }

  function setActiveByHash(hash) {
    var subLinks = sidebar.querySelectorAll('.busdk-sidebar-sub-link');
    var anySubCurrent = false;
    subLinks.forEach(function (a) {
      a.classList.remove('busdk-sidebar-sub-link--current');
      var n = norm(a.getAttribute('href'));
      if (n.path === pathname && n.hash === hash) {
        a.classList.add('busdk-sidebar-sub-link--current');
        anySubCurrent = true;
      }
    });
    if (anySubCurrent) {
      sidebar.querySelectorAll('.busdk-sidebar-item').forEach(function (item) {
        var sub = item.querySelector('.busdk-sidebar-sub-link--current');
        if (sub) item.querySelector('.busdk-sidebar-link').classList.remove('busdk-sidebar-link--current');
      });
    }
  }

  function onHashChange() {
    setActiveByHash(window.location.hash.slice(1));
  }

  window.addEventListener('hashchange', onHashChange);
  onHashChange();

  var main = document.querySelector('.busdk-main');
  if (!main) return;
  var subLinkHrefs = [];
  sidebar.querySelectorAll('.busdk-sidebar-sub-link').forEach(function (a) {
    var n = norm(a.getAttribute('href'));
    if (n.path === pathname && n.hash) subLinkHrefs.push(n.hash);
  });
  if (subLinkHrefs.length === 0) return;

  var headingIds = new Set(subLinkHrefs);
  var headings = main.querySelectorAll('h2[id], h3[id], h4[id], h5[id], h6[id]');
  var observed = [];
  headings.forEach(function (h) {
    if (headingIds.has(h.id)) observed.push(h);
  });
  if (observed.length === 0) return;

  var ticking = false;
  var currentId = '';

  function setActiveFromScroll() {
    var top = window.scrollY || document.documentElement.scrollTop;
    var viewportMid = top + window.innerHeight * 0.35;
    var active = null;
    for (var i = observed.length - 1; i >= 0; i--) {
      var rect = observed[i].getBoundingClientRect();
      var elTop = rect.top + top;
      if (elTop <= viewportMid) {
        active = observed[i].id;
        break;
      }
    }
    if (!active && observed.length) active = observed[0].id;
    if (active === currentId) return;
    currentId = active;
    history.replaceState(null, '', '#' + active);
    setActiveByHash(active);
  }

  function onScroll() {
    if (!ticking) {
      requestAnimationFrame(function () {
        setActiveFromScroll();
        ticking = false;
      });
      ticking = true;
    }
  }

  var observer = new IntersectionObserver(
    function () { onScroll(); },
    { root: null, rootMargin: '-20% 0px -60% 0px', threshold: 0 }
  );
  observed.forEach(function (h) { observer.observe(h); });
  setActiveFromScroll();
})();
    </script>
    {% endunless %}
  </body>
</html>

---
title: bus-dev
description: "bus dev is a developer-only companion that centralizes workflow logic that module repositories would otherwise duplicate in scripts/: module scaffolding, AGENTS.md creation and refinement, commit workflows, planning, agent-runner workflows, and e2e test scaffolding."
---

## `bus-dev` — developer workflows for BusDK module repositories

### Synopsis

`bus dev [-h] [-V] [-v] [-q] [-C <dir>] [-o <file>] [--color <auto|always|never>] [--no-color] [--agent <cursor|codex|gemini|claude>] <operation> [operation ...]`

Operations: **`init`**, **`commit`**, **`plan`**, **`spec`**, **`stage`**, **`work`**, **`e2e`**, **`set`**. Only one invocation that operates on a given directory (init, commit, stage, plan, work, spec, e2e) runs at a time for that directory; a second invocation for the same directory waits until the first exits. The workflow operations **plan**, **spec**, **work**, **e2e**, **stage**, and **commit** can be run in any order and combination in a single invocation: for example `bus dev plan spec work`, `bus dev plan work stage commit`, or `bus dev spec plan work stage commit plan work stage commit`. When you list two or more operations, they run one at a time in the order you give them and the run stops on first failure. **init** accepts an optional directory, then zero or more workflow operations from the set plan, spec, work, e2e (stage and commit are not accepted after init), executed in the order provided. The **`set`** subcommands do not participate in the per-directory lock.

`bus dev init [DIR] [--lang go] [plan|spec|work|e2e ...]` — initialize module files in the current directory by default, or in `DIR` when provided; does not run plan/spec/work/e2e unless explicitly listed.  
`bus dev commit` — commit staged changes with high-quality messages (no remote, no history rewrite).  
`bus dev stage` — prepare the working tree for commit by having the agent ensure only intended files are staged: identify temporary files, e2e leftovers, and other files that should not be tracked, add them to `.gitignore` or remove them, then stage the rest; combinable with plan, spec, work, e2e, and commit so you can run full cycles in one invocation.  
`bus dev plan` — review SDD and docs against repository state, then refresh `PLAN.md` with prioritized unchecked undone work items only.  
`bus dev spec` — ensure the repository has a compact but detailed local spec in [AGENTS.md](https://agents.md/) that reflects the latest BusDK specifications and describes how to implement this tool; creates AGENTS.md from online SDD and user documentation when missing.  
`bus dev work` — run the “do the work in this repo” agent workflow (code, tests, README).  
`bus dev e2e` — guided workflow to detect and scaffold missing end-to-end tests.  
`bus dev set agent <cursor|codex|gemini|claude>` — set the bus-dev persistent default agent (`bus-dev.agent`) via the bus-preferences Go library.  
`bus dev set model <value>` — set the bus-dev persistent default model (`bus-dev.model`).  
`bus dev set output-format <ndjson|text>` — set the bus-dev persistent default output format (`bus-dev.output_format`).  
`bus dev set timeout <duration>` — set the bus-dev persistent default timeout (`bus-dev.timeout`).  
`bus dev [plan|spec|work|e2e|stage|commit] ...` — run one or more of plan, spec, work, e2e, stage, and commit in the order you list them (e.g. `bus dev plan spec work` or `bus dev plan work stage commit`); if one fails, the run stops.

### Description

Command names follow [CLI command naming](../cli/command-naming). `bus dev` is a developer-only companion that centralizes workflow logic that module repositories would otherwise duplicate in `scripts/`: module scaffolding, commit workflows, planning from documentation coverage gaps, agent-runner workflows, AGENTS.md creation and refinement (from online SDD and user docs when missing), and e2e test scaffolding. It provides a single entry point so behavior and prompts stay consistent and maintainable in one place, as described in the [module SDD](../sdd/bus-dev). Agent runtime execution (invoking Cursor CLI, Codex, Gemini CLI, or Claude CLI) is provided by the [bus-agent](../sdd/bus-agent) library so that runtimes, detection, and diagnostics are consistent across BusDK; bus-dev supplies the workflow prompts and repository context. Bus-dev uses the same instruction model as bus-agent: **AGENTS.md** at the repository root is the canonical, vendor-neutral source of project instructions for commit, work, spec, and e2e; per-runtime adapters (Codex, Cursor, Gemini CLI, Claude Code) follow the contract defined in the [bus-agent SDD](../sdd/bus-agent), so the agent instruction contract is shared and testable across modules. The CLI accepts a single operation (e.g. `bus dev work`) or multiple operations in one invocation. The workflow operations — plan, spec, work, e2e, stage, and commit — can be combined in any order and any combination (including repeating one, e.g. `bus dev plan work stage commit plan work stage commit`); when multiple are given, they run one at a time in the order you list them and the run stops on first failure. Use **stage** when you want to prepare the working tree for commit in the same run as plan, work, or commit: the agent ensures temporary files, e2e test leftovers, and other unintended files are either added to `.gitignore` or removed before staging, so you do not accidentally commit them. Most subcommands operate on the **current Git repository** (source code and agent instructions in AGENTS.md); `bus dev init` is the exception — it can initialize files in place for the current directory, or in an explicitly provided target directory, without creating or touching a Git repository unless you do that yourself later. The tool does not operate on workspace accounting datasets. End users running `bus accounts`, `bus journal`, or `bus validate` do not need `bus dev`; it exists for contributors and automation working inside (or creating) a BusDK module repository.

All paths and the working directory are resolved relative to the current directory unless you set `-C` / `--chdir`. The tool discovers the repository root from the effective working directory and does not require a config file for repository-scoped commands. Subcommands that need a module name in repository scope (for example for e2e script naming) derive it deterministically from the repository: the module name is the base name of the repository root directory (the last path component of the absolute path to the repo root). For `init`, which can run outside a Git repository, the module name is derived from the base name of the init target directory.

Only one `bus dev` run that operates on a given directory (init, commit, stage, plan, work, spec, e2e) executes at a time for that directory. A second invocation that targets the same directory blocks until the first exits, then proceeds. This avoids concurrent edits to PLAN.md, AGENTS.md, and the staging area. The `set` subcommands do not take the lock and do not block. If the lock cannot be acquired (for example the directory is not writable), the command exits with code 1 and a clear message; see Exit status and errors.

**Safety.** `bus dev` never runs remote Git operations (no push, pull, fetch, clone) and never rewrites history (no amend, rebase, squash). It may run the agent (for **stage**, **plan**, **work**, **spec**, **e2e**), local `git add` after the agent has cleaned the working tree (for **stage**), and local `git commit` only on already-staged content (commit never stages; use **stage** to stage). Bus-dev never edits any user configuration outside the project working directory; when it creates or modifies repo-local files for instruction or adapter support, changes are additive only (append-only Bus-owned blocks, no removal or rewrite of your content). The only exception is the legacy Cursor rule file at `.cursor/rules/<module-name>.mdc`, which may be replaced or migrated into AGENTS.md during `bus dev spec`. Diagnostics and progress go to stderr; stdout is reserved for deterministic results when a subcommand produces them. When run from a script or CI (headless), workflows remain non-interactive and do not perform prohibited actions such as network operations or modifying user-global agent configuration.

### Commands

**`init [DIR] [--lang go] [plan|spec|work|e2e ...]`** — Initialize module root files without performing any Git operations. If `DIR` is omitted, initialization happens in the effective current working directory. If `DIR` is provided, initialization happens there (the directory is created if missing). When you run init, it ensures a single [AGENTS.md](https://agents.md/) exists at the project root (the target directory) and ensures a root `Makefile` exists by writing a built-in sample Makefile when missing. Init is not required to create AGENTS.md: in an existing repository you can run `bus dev spec` and the tool creates AGENTS.md from the online SDD and module end-user documentation when the file is missing. The `--lang` flag defaults to `go` and controls which default AGENTS.md content init installs when you use init. By default this command only initializes files; it does **not** run `plan`, `spec`, `work`, or `e2e`. To run workflow operations as part of init, append them explicitly in any order; they run in the exact order you provide, for example `bus dev init plan spec work` or `bus dev init bus-accounts work plan e2e` (target directory). If any requested step fails, the command exits non-zero with a clear diagnostic. Use this when you want deterministic in-place initialization first, then optional AI workflow steps under explicit control.

**`commit`** — Create one or more commits from the **currently staged** changes only. If there is nothing staged (and no submodules with staged changes to commit), the command does nothing and exits 0. The tool does not modify files, does not stage anything, and does not amend or rebase. If the repository has submodules, it commits inside submodules first (depth-first), then the superproject only if it has staged changes. If a submodule commit leaves an unstaged gitlink in the superproject, the tool reports that clearly and stops without staging it; you must stage the gitlink manually if desired. For each commit, the message must have a concise, imperative subject line; a body may follow, with traceability (issue IDs or URLs) when helpful. By default the tool commits exactly what is currently staged and does not alter the staging area. If a hook (e.g. pre-commit, commit-msg) fails, the tool reports the failure and exits non-zero; it does not retry.

**`stage`** — Prepare the working tree for commit by ensuring only intended files are staged. The tool invokes the configured agent with an embedded prompt that instructs it to review the working tree, identify files that should not be tracked (for example temporary files, e2e test leftovers, or build artifacts), and either add them (or matching patterns) to `.gitignore` or remove them from the project. After the agent has finished, the tool stages all remaining changes at the repository root so that a subsequent **commit** has only the intended content. May be combined with **plan**, **spec**, **work**, **e2e**, and **commit** in any order (e.g. `bus dev plan work stage commit`). Does not commit, amend, or rebase, and does not perform any remote Git operations. If the repository has submodules, only the current repository’s working tree is in scope; see the [module SDD](../sdd/bus-dev) for the normative rule.

**`plan`** — Build or refresh `PLAN.md` at repository root as a compact prioritized checklist of undone work. May be combined with **spec**, **work**, and **e2e** in any order; operations run in the order you list them and stop on first failure. The command reviews the current repository, the [main SDD](../sdd), the current module SDD, the current module end-user docs, and other project SDD pages relevant to requirement coverage. It detects unimplemented features and other undone work and writes only `PLAN.md`. When `PLAN.md` already exists, the command re-validates existing items, removes items that are already done (including checked items), keeps items that are still undone, and adds newly detected missing work. This command is the one that prunes completed checked items from the plan. The file written by `bus dev plan` is a compact unchecked task list ordered by priority, with one unchecked item per undone work item and no implementation-level detail that should instead come from the SDD and related docs.

**`work`** — Run the canonical “do the work in this repo now” workflow. May be combined with **plan**, **spec**, and **e2e** in any order (e.g. `bus dev plan work` or `bus dev work plan spec e2e`); operations run in the order you list them and stop on first failure. At the start of each agent step (plan, work, spec, e2e, stage), the tool prints to stderr which internal agent runtime and which model are in use for that step. The tool invokes the configured external agent runtime with an embedded prompt that tells it to operate only inside the current module repository: make concrete code changes, add or update tests, run the Makefile checks, and update README before finishing. The agent is allowed to read the repository’s AGENTS.md and design docs as the authoritative specs. When `PLAN.md` exists at repository root, the workflow reads it first and prioritizes unchecked items before proposing additional work. As work items are completed, `bus dev work` checks them off in `PLAN.md`. It does not remove already checked items; checked-item pruning is handled by `bus dev plan`. When the selected runtime is Gemini CLI, the agent may also use repository-local Gemini context (e.g. repo-root `GEMINI.md`, `.gemini/settings.json`, `.geminiignore`); Bus Dev never modifies user-global Gemini configuration or memory. Which agent runtime is used is determined by the agent selection configuration (see below). This subcommand does not perform any Git remote operations.

**`spec`** — Ensure the repository has a compact but detailed local spec in [AGENTS.md](https://agents.md/) that reflects the latest BusDK specifications and describes how to implement this tool. May be combined with **plan**, **work**, and **e2e** in any order; operations run in the order you list them and stop on first failure. The file is always `AGENTS.md` at the repository root. When AGENTS.md does not exist, the command creates it from the online SDD and module end-user documentation in the same run. If a Cursor rule file exists at `.cursor/rules/<module-name>.mdc` (where the module name is the base name of the repo, e.g. `bus-accounts`), its content is refactored into AGENTS.md and that file is then removed. No source code, tests, or README are changed. The refinement is driven by an embedded prompt inside the binary; the agent may read BusDK docs and the AGENTS.md format to align the file. When Gemini CLI is selected, repository-local Gemini context is used in parallel; Bus Dev does not write to user-global Gemini config or memory.

**`e2e`** — Guided workflow to detect missing end-to-end tests for the current module and scaffold them in a hermetic way, consistent with BusDK testing conventions and the module’s [SDD](../sdd/bus-dev) and end-user documentation. May be combined with **plan**, **spec**, and **work** in any order; operations run in the order you list them and stop on first failure. E2E tests are Bash scripts under `tests/` named `e2e_bus_<name>.sh`, where `<name>` is the module name with the `bus-` prefix stripped (for example `bus-accounts` → `tests/e2e_bus_accounts.sh`). The tool uses the module’s SDD and end-user docs to determine which tests are needed and produces scaffolds that cover the behavior described there. When `PLAN.md` exists at repository root, the workflow reads it first, treats checked items as completed-feature coverage obligations, verifies each checked item is fully covered by e2e tests, and prioritizes unchecked test-related items. It also continues to search SDD and end-user docs for other untested behavior exactly as it does without `PLAN.md`. This subcommand does not remove already checked plan items; checked-item pruning is handled by `bus dev plan`. The command does not perform remote Git operations or modify workspace accounting datasets.

**`set`** — Set a persistent preference via the [bus-preferences](./bus-preferences) Go library (no shell-out to `bus preferences`). Bus-dev provides a dedicated subcommand for each key that affects agent use:

**`set agent <runtime>`** — Set the bus-dev persistent default agent (`bus-dev.agent`) via the bus-preferences Go library. Only the `bus-dev` namespace is written; no other namespace is modified. `<runtime>` must be one of `cursor`, `codex`, `gemini`, or `claude`. Invalid runtime yields exit 2.

**`set model <value>`** — Set the bus-dev persistent default model (`bus-dev.model`) via the bus-preferences Go library. Only the `bus-dev` namespace is written. Invalid value yields exit 2.

**`set output-format <ndjson|text>`** — Set the bus-dev persistent default output format (`bus-dev.output_format`) via the bus-preferences Go library. Valid values: `ndjson` (raw structured output), `text` (human-readable). Only the `bus-dev` namespace is written. Invalid value yields exit 2.

**`set timeout <duration>`** — Set the bus-dev persistent default timeout (`bus-dev.timeout`) via the bus-preferences Go library (e.g. `60m`). Only the `bus-dev` namespace is written. Invalid value yields exit 2.

### Global flags

These flags apply to all subcommands. The common subset matches the [standard global flags](../cli/global-flags); `bus dev` adds `--agent` for runtime selection. They can appear in any order before the subcommand. A lone `--` ends flag parsing; any following tokens are passed to the subcommand.

- **`-h`**, **`--help`** — Print help to stdout and exit 0. Other flags and arguments are ignored when help is requested.
- **`-V`**, **`--version`** — Print the tool name and version to stdout and exit 0.
- **`-v`**, **`--verbose`** — Send verbose progress and diagnostics to stderr. You can repeat the flag (e.g. `-vv`) to increase verbosity. Verbose output does not change what is written to stdout.
- **`-q`**, **`--quiet`** — Suppress normal command result output. When quiet is set, only errors go to stderr. Exit codes are unchanged. You cannot combine `--quiet` with `--verbose`; doing so is invalid usage (exit 2).
- **`-C <dir>`**, **`--chdir <dir>`** — Use `<dir>` as the effective working directory. The repository root and all paths are resolved from this directory. If it does not exist or is not accessible, the command exits with code 1. If the effective directory is not inside a Git repository, subcommands that require a repo exit with code 2 and a clear message.
- **`-o <file>`**, **`--output <file>`** — Redirect normal command output to `<file>` instead of stdout. The file is created or truncated. Errors and diagnostics still go to stderr. If both `--output` and `--quiet` are used, quiet wins: no output is written to the file.
- **`--color <mode>`** — Control colored output on stderr. `<mode>` must be `auto`, `always`, or `never`. Invalid value is usage error (exit 2).
- **`--no-color`** — Same as `--color=never`.
- **`--agent <runtime>`** — Select the agent runtime for this invocation only. `<runtime>` must be one of `cursor`, `codex`, `gemini`, or `claude`. Invalid value is usage error (exit 2). This overrides the default set by `BUS_DEV_AGENT`, `BUS_AGENT`, and any persistent preferences (see Agent runtime selection below).

Command results are written to stdout when a subcommand produces them. Diagnostics, progress, and human-readable agent output are written to stderr.

### Agent runtime selection

Subcommands that invoke an external agent (`plan`, `work`, `spec`, and `e2e`, including when these are requested after `init`) use the [bus-agent](../sdd/bus-agent) library and one of its supported runtimes: **Cursor CLI**, **Codex**, **Gemini CLI**, and **Claude CLI**. At the start of each such step, the tool prints to stderr which internal agent and which model are in use so that logs and scripts can see the active runtime and model.

The active runtime is chosen in this order: (1) **`--agent <runtime>`** for that invocation; (2) **`BUS_DEV_AGENT`** (bus-dev-only session default; when set, used for every `bus dev` command in that session until unset or overridden); (3) **`BUS_AGENT`** (shared session default, used when `BUS_DEV_AGENT` is not set); (4) **bus-dev persistent preference** (e.g. `bus-dev.agent` via [bus-preferences](./bus-preferences), affects only bus-dev); (5) **bus-agent persistent preference** (`bus-agent.runtime`); (6) **first available** runtime in the effective order (alphabetic by runtime ID by default). Set bus-dev’s default with `bus preferences set bus-dev.agent <runtime>` and the shared default with `bus preferences set bus-agent.runtime <runtime>`. At any step, if the configured runtime is **disabled** by user configuration, the tool prints a warning to stderr and continues with the next source. You can configure agent order and enable/disable; see the [bus-agent](../sdd/bus-agent) SDD and [bus-agent module docs](./bus-agent).

Invalid runtime names (e.g. `--agent unknown` or an invalid value in `BUS_DEV_AGENT` or `BUS_AGENT`) produce a clear usage error and exit 2. If the user has selected an agent (via flag or `BUS_DEV_AGENT`) and that agent’s CLI is not installed or not in PATH, the tool reports that on stderr, directs you to the canonical installation URL for that runtime, and exits with code 1. When no runtime is selected and no agent is available (none in PATH or all disabled/restricted), the tool exits with a clear diagnostic and directs you to install or enable at least one supported agent, with pointers to the canonical installation URLs for each runtime. Model, output format, and timeout follow the same resolution logic as agent (see Preference settings below): bus-dev session env (`BUS_DEV_MODEL`, `BUS_DEV_TIMEOUT`, `BUS_DEV_OUTPUT_FORMAT`), then bus-dev persistent preferences (`bus-dev.model`, `bus-dev.timeout`, `bus-dev.output_format`), then bus-agent preferences as fallback, then bus-agent defaults (e.g. model `auto`, output format `text`).

### Preference settings (bus-preferences)

Preferences that affect `bus dev` are stored via the [bus-preferences](./bus-preferences) Go library. **Bus-dev only ever writes to the `bus-dev` namespace.** When you run `bus dev set agent`, `bus dev set model`, `bus dev set output-format`, or `bus dev set timeout`, the tool writes only the corresponding `bus-dev.*` key (e.g. `bus-dev.agent`, `bus-dev.model`, `bus-dev.output_format`, `bus-dev.timeout`) and never modifies `bus-agent.*` or any other namespace. When bus-dev invokes the agent (plan, work, spec, e2e), it resolves each option in the same order: per-command override (e.g. `--agent`) if present, then bus-dev session environment (`BUS_DEV_AGENT`, `BUS_DEV_MODEL`, `BUS_DEV_TIMEOUT`, `BUS_DEV_OUTPUT_FORMAT`), then bus-dev persistent preferences (`bus-dev.agent`, `bus-dev.model`, `bus-dev.timeout`, `bus-dev.output_format`), then bus-agent persistent preferences as fallback (`bus-agent.runtime`, `bus-agent.model`, `bus-agent.output_format`, `bus-agent.timeout`), then bus-agent defaults. Set any bus-dev default with **`bus dev set <key> <value>`** (e.g. `bus dev set agent gemini`, `bus dev set model auto`, `bus dev set output-format text`, `bus dev set timeout 60m`) or with `bus preferences set bus-dev.<key> <value>`. Inspect with `bus preferences get <key>`. The bus-dev CLI uses the bus-preferences library directly and does not shell out to `bus preferences`.

| Key | Description |
|-----|-------------|
| `bus-dev.agent` | Bus-dev default agent runtime. Valid values: **`cursor`**, **`codex`**, **`gemini`**, **`claude`**. Resolution order: `--agent` → `BUS_DEV_AGENT` → `BUS_AGENT` → `bus-dev.agent` → `bus-agent.runtime` → first available. Set with `bus dev set agent <runtime>`. For the shared default when not using bus-dev, set `bus-agent.runtime` via `bus agent set runtime <runtime>`. |
| `bus-dev.model` | Bus-dev default model (e.g. for Cursor). Resolution order: per-command override (if any) → `BUS_DEV_MODEL` → `bus-dev.model` → `bus-agent.model` → bus-agent default (`auto`). Set with `bus dev set model <value>`. |
| `bus-dev.output_format` | Bus-dev default output format. Valid values: **`ndjson`** (raw structured output), **`text`** (human-readable). Resolution order: per-command override (if any) → `BUS_DEV_OUTPUT_FORMAT` → `bus-dev.output_format` → `bus-agent.output_format` → bus-agent default (`text`). Set with `bus dev set output-format <ndjson|text>`. |
| `bus-dev.timeout` | Bus-dev default run timeout as a duration string (e.g. `60m`). Resolution order: per-command override (if any) → `BUS_DEV_TIMEOUT` → `bus-dev.timeout` → `bus-agent.timeout` → bus-agent default. Set with `bus dev set timeout <duration>`. |

### Example: building a module from scratch with AI

BusDK specifications are openly readable. You can have an AI-assisted workflow build a bus module from scratch, then optionally initialize Git and commit. Prerequisites: install one of the supported agent runtimes (Cursor CLI, Codex, Gemini CLI, or Claude CLI), BusDK (at least v0.0.15), and Go.

**Option: initialize only, then run workflows explicitly.** From the module root you want to initialize, run `bus dev init [--lang go]`. Or from a parent directory, run `bus dev init bus-accounts [--lang go]`. The tool initializes a root [AGENTS.md](https://agents.md/) and a root `Makefile` (from a built-in sample when missing). It does not run any Git commands and does not run `spec`, `work`, or `e2e` unless you ask for them. After initialization, run `bus dev plan` to refresh `PLAN.md`, then run `bus dev spec work e2e` in that module directory when you want the AI workflow sequence.

**Option: initialize and run ordered workflows in one command.** If you want initialization plus workflow operations in one invocation, append the operations after init. `bus dev init spec work e2e` initializes the current directory and runs the three operations in that exact order. `bus dev init bus-accounts spec work e2e` does the same in `bus-accounts`. If one operation fails, later operations are not run.

**Option: manual steps.** If you prefer to create everything yourself, create the module directory and a root `Makefile` (and optionally a root [AGENTS.md](https://agents.md/) if you want a starting point), then run `bus dev spec work e2e` (or the three operations in separate invocations), then initialize Git and commit as desired. You do not need to create `AGENTS.md` first: `bus dev spec` creates it from the online SDD and module end-user documentation when it is missing. The `--lang` flag on `init` (default `go`) controls which default AGENTS.md content is installed when you use init instead of creating files manually.

**Option: full cycle in one invocation.** To run plan, work, stage, and commit repeatedly without leaving the tool, combine operations: `bus dev plan work stage commit plan work stage commit`. Each **stage** invokes the agent to clean the working tree (update `.gitignore` or remove unintended files), then stages the remaining changes so the following **commit** has only intended content.

Because the specs are public and machine-readable, this flow lets you regenerate or rewrite any bus module from scratch with AI, without depending on pre-packaged source. If you prefer not to build from specs yourself, we offer tested and verified bus module source code for a fee. We also offer compiled binaries for free.

### Files

`bus dev` does not read or write workspace accounting datasets (CSV, schemas, datapackage.json). It operates on the Git repository (metadata and index) and, when running the agent, on the repository working tree (source files, repository-root **AGENTS.md** as the canonical project instruction source). To ensure only one run per directory at a time, the tool uses a lock file (e.g. `.bus-dev.lock`) in the effective operation directory; the lock is released when the command exits. The documentation base URL used in prompts and diagnostics is configurable via `BUS_DEV_DOCS_BASE_URL` (default `https://docs.busdk.com`). `bus dev spec` creates or updates repository-root `AGENTS.md`, creating it from the online SDD and module end-user documentation when missing so the result is a compact local implementation spec; if a Cursor rule file exists at `.cursor/rules/<module-name>.mdc` (module name = base name of the repo), its content is merged into `AGENTS.md` and that file is then removed — this is the only case where bus-dev may remove or replace existing repo content for instruction standardization. The tool also uses repository-root `PLAN.md` for planning continuity: `bus dev work` checks off completed plan items, `bus dev e2e` validates that checked items are fully covered by e2e tests and still searches docs for other missing tests, and neither `work` nor `e2e` removes checked items. `bus dev plan` is the command that re-validates the plan and prunes completed checked items while adding newly detected missing work. When Gemini CLI is selected, the tool uses only repository-local Gemini files (e.g. repo-root `GEMINI.md`, `.gemini/settings.json`, `.geminiignore`) and never modifies user-global Gemini configuration or memory. How each runtime (Codex, Cursor, Gemini CLI, Claude Code) loads AGENTS.md is defined by the shared instruction contract in the [bus-agent SDD](../sdd/bus-agent). No bus-dev-specific config file is required; configuration is via flags and environment only.

### Exit status and errors

- **0** — Success. For `bus dev commit`, “nothing to commit” is success.
- **1** — Execution failure: Git command failed, hook failed, agent failed or timed out, selected agent runtime not found or not executable, no agent enabled when the automatic default would apply, or working-directory lock could not be acquired (e.g. directory not writable).
- **2** — Invalid usage: unknown subcommand, invalid flag (including invalid `--agent` or `set agent` runtime name), or precondition not met (e.g. not in a Git repository for commands that require one, or init target path is not a directory).

Error messages are always on stderr. If you are not in a Git repository when a subcommand requires one, the tool exits with code 2 and a clear message. If the selected agent runtime is missing or cannot be executed, or if no agent is enabled when the automatic default would apply, the tool exits with code 1 and directs you to the canonical installation URLs for the supported runtimes. If the working-directory lock cannot be acquired (e.g. the directory is not writable or the lock file cannot be created), the tool exits with code 1 and reports that the lock could not be acquired; check directory permissions or whether another `bus dev` process is running in that directory.

### Development state

**Value:** Developer tooling to scaffold and run standardized workflows (commit, work, spec, e2e, set) in BusDK module repos so contributors get a consistent Makefile, rules, and prompts.

**Completeness:** 60% (Stable for one use case) — commit, work, spec, e2e, set and init scaffold are verified by e2e; global flags and error paths are test-backed.

**Current:** E2e script `tests/e2e_bus_dev.sh` proves help, version, subcommand help, terminator, invalid quiet+verbose and color, missing chdir, and init creating Makefile, `.cursor/rules`, and stubs in the target directory. Unit tests cover run, resolve, scaffold, prompts, and set (`run/run_test.go`, `internal/init/scaffold_test.go`, etc.).

**Planned next:** Per-directory lock; remove `-f`/`--format`; e2e assert AGENTS.md at target root; README exit-codes and prompt names.

**Blockers:** None known.

**Depends on:** None.

**Used by:** Developers in module repositories; no other bus module invokes it.

See [Development status](../implementation/development-status).

---

<!-- busdk-docs-nav start -->
<p class="busdk-prev-next">
  <span class="busdk-prev-next-item busdk-prev">&larr; <a href="./bus-data">bus-data</a></span>
  <span class="busdk-prev-next-item busdk-index"><a href="./index">Module CLI reference</a></span>
  <span class="busdk-prev-next-item busdk-next"><a href="./bus-agent">bus-agent</a> &rarr;</span>
</p>
<!-- busdk-docs-nav end -->

### Sources

- [BusDK — installation and overview](https://busdk.com/)
- [Module SDD: bus-agent](../sdd/bus-agent)
- [Module SDD: bus-preferences](../sdd/bus-preferences)
- [Module SDD: bus-dev](../sdd/bus-dev)
- [bus-preferences CLI reference](./bus-preferences)
- [bus-config CLI reference](./bus-config)
- [CLI: Error handling, dry-run, and diagnostics](../cli/error-handling-dry-run-diagnostics)
- [Implementation: Module repository structure and dependency rules](../implementation/module-repository-structure)
- [Gemini CLI — install](https://geminicli.com/)
- [Cursor CLI — overview and install](https://cursor.com/docs/cli/overview)
- [Claude Code — get started / install](https://github.com/anthropics/claude-code?tab=readme-ov-file#get-started)
- [Codex CLI — install](https://developers.openai.com/codex/cli/)
- [AGENTS.md — open format for guiding coding agents](https://agents.md/)
